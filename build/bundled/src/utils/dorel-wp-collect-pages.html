<html><head></head><body><dom-module id="dorel-wp-collect-pages">
  <template>
    <iron-ajax auto="" url="[[ endPoint ]]" handle-as="json" on-response="_pagesLoaded"></iron-ajax>

    <iron-ajax id="products" url="" handle-as="json" on-response="_productsLoaded"></iron-ajax>
  </template>

  <script>Polymer({is:"dorel-wp-collect-pages",properties:{endPoint:{type:String},collect:{type:Array,value:[]},perPage:{type:Number,value:100}},observers:["_initPages(globals.Dorel.wpUrl)"],_initPages:function(e){"undefined"!=typeof e&&""!==e&&this._hasProps(e)&&(this.endPoint=this.globals.Dorel.wpUrl+"/wp/v2/pages?per_page="+this.perPage)},_pagesLoaded:function(e){var t=this,r=t.$.products,a=e.detail.response;if(a.length){for(var l=0,o=a.length;l<o;l++){var c=a[l].template.slice(0,-4),p=c.replace("page-","");a[l].template=p}t.collect=t.collect.concat(a),r.url=this.globals.Dorel.wpUrl+"/wp/v2/products",r.generateRequest()}},_productsLoaded:function(e){var t=this,r=e.detail.response;if(r.length)for(var a={slug:"products",template:"products",title:{rendered:"products"},products:[]},l=0,o=r.length;l<o;l++){r[l].template="product-detail";var c={meta_description:r[l].acf.meta_description||"",meta_title:r[l].acf.meta_title||"",page_builder:[]};for(var p in r[l].acf.product_detail_builder[0]){var i=r[l].acf.product_detail_builder[0][p]?r[l].acf.product_detail_builder[0][p][0]:"";i.acf_fc_layout=p,c.page_builder=c.page_builder.concat(i)}r[l].acf=c}a.products=a.products.concat(r),t.collect=t.collect.concat(a),Polymer.globalsManager.set("Dorel.collect.pages",t.collect)},_hasProps:function(e){var t=!1;for(var r in e)t=!!e.hasOwnProperty(r);return t}});</script>
</dom-module>
</body></html>