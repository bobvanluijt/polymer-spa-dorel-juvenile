<html><head><link rel="import" href="../organisms/dorel-category-listing.html">
<link rel="import" href="../organisms/dorel-section-category-header.html">
<link rel="import" href="../organisms/dorel-section-category-sidebar.html">

</head><body><dom-module id="dorel-template-product-category">
  <template>
    <style>
      :root {
        /* Override the default background-color for the multi sections */
        --theme-multi-background-color: var(--theme-color-background-tertiary);
        --theme-multi-no-background-color: transparent;
        --theme-multi-bottom-padding: var(--theme-component-space-inner-xlarge);
        float: left;
        width: 100%;
      }

      .container {
        @apply(--max-width-container);
        padding-top: 1.5em;
        box-sizing: border-box;
      }

      .row {
        @apply(--theme-grid-row);
        @apply(--layout-flex);
      }

      dorel-section-category-header {
        @apply(--theme-grid-column);
        -ms-flex-preferred-size: 100%;
        flex-basis: 100%;
        max-width: 100%;
        order: 0;
        margin-top: 0;
      }

      dorel-section-category-sidebar {
        @apply(--theme-grid-column);
        -ms-flex-preferred-size: 100%;
        flex-basis: 100%;
        max-width: 100%;
        order: 1;
        margin-top: 1.5em;
      }

      dorel-layout-section dorel-page-builder {
        width: 100%;
        display: flex;
      }

      [desktop-small-up] dorel-section-category-header {
        -ms-flex-preferred-size: calc(var(--theme-column-width) * 9);
        flex-basis: calc(var(--theme-column-width) * 9);
        max-width: calc(var(--theme-column-width) * 9);
        order: 1;
      }

      [desktop-small-up] dorel-section-category-sidebar {
        -ms-flex-preferred-size: calc(var(--theme-column-width) * 3);
        flex-basis: calc(var(--theme-column-width) * 3);
        max-width: calc(var(--theme-column-width) * 3);
        order: 0;
      }

      [tablet-medium-up] .container {
        padding: 1.5em var(--theme-gutter) 0 var(--theme-gutter);
      }

      [tablet-medium-up] .row {
        @apply(--theme-grid-row-margins);
      }
    </style>

    <dorel-media-query breakpoints="{{ breakpoints }}"></dorel-media-query>

    <div tablet-medium-up$="{{ breakpoints.tabletMediumUp }}" desktop-small-up$="{{ breakpoints.desktopSmallUp }}">
      <iron-ajax auto="" url="[[ categoriesEndPoint ]]" handle-as="json" on-response="_categoriesLoaded"></iron-ajax>

      
      <template is="dom-if" if="{{ products.length }}">

        
        <template is="dom-if" if="{{ templateData.acf.page_builder.length }}">

          <div class="container layout horizontal center center-justified wrap">
            <div class="row">
              
              <template is="dom-repeat" items="[[ templateData.acf.page_builder ]]" as="component" targetframerate="1000">

                
                <template is="dom-if" if="{{ isPageComponent(component.acf_fc_layout, 'section_category_header') }}">
                  <dorel-section-category-header category-header-data="[[ component ]]" gtm-parent="dorel-section-category-header" gtm-parent-index="[[ index ]]"></dorel-section-category-header>
                </template>
                

                
                <template is="dom-if" if="{{ isPageComponent(component.acf_fc_layout, 'section_category_sidebar') }}">
                  <dorel-section-category-sidebar category-sidebar-data="[[ component ]]" gtm-parent="dorel-section-category-sidebar" gtm-parent-index="[[ index ]]"></dorel-section-category-sidebar>
                </template>
                
              </template>
            </div>
          </div>
        </template>
      </template>

      <dorel-category-listing products-data="[[ products ]]" gtm-parent="dorel-category-listing" gtm-parent-index="2"></dorel-category-listing>

      <template is="dom-if" if="{{ !products.length }}">
        <p>No products assigned to this category</p>
      </template>
    </div>
  </template>
  <script>Polymer({is:"dorel-template-product-category",properties:{templateData:{type:Object,value:function(){return{}},observer:"_templateDataChanged"},products:{type:Array,value:[]}},_templateDataChanged:function(){if("product-category"===this.templateData.template){var t=Polymer.globalsManager.get("Dorel.collect.categories"),e=Polymer.globalsManager.get("Dorel.collect.pages");this._initProductsPage(t,e)}},_initProductsPage:function(t,e){var r=this;this.products=[];for(var a=t.find(function(t){return t.id===r.templateData.acf.product_category}),o=e.find(function(t){return"products"===t.template}),s=0;s<o.products.length;s++)0===o.products[s].categories.indexOf(a.id)&&(this.products=this.products.concat(o.products[s]))},isPageComponent:function(t,e){var r=t.substr(t.length-1);if(!isNaN(Number(r))){var a=t.split("_");return a.pop(),strippedResponse=a.join("_"),strippedResponse===e}return t===e}});</script>
</dom-module>
</body></html>