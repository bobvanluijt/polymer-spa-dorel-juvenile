<dom-module id="dorel-color-switcher">
  <template>
    <style>
      .color-name {
        @apply(--theme-typography-2);
        margin: 1em 0 .5em 0;
      }

      .list-group {
        list-style: none;
        float: left;
        padding: 0;
        margin: 0.1875em 0;
      }

      .list-group-item {
        float: left;
        border: 2px solid transparent;
        border-radius: 2em;
        padding: .25em;
        transition: border .3s ease;
        margin-right: .5em;
      }

      .list-group-item.active {
        border: 2px solid var(--theme-brand-color-1);
      }

      .list-group-item span {
        display: block;
        border-radius: 1em;
        width: 1.75em;
        height: 1.75em;
        border: 1px solid var(--theme-color-monochrome-3);
        cursor: pointer;
        transition: opacity .3s ease;
      }

      .list-group-item span:focus, .list-group-item span:hover {
        outline: none;
        opacity: .7;
      }

      .color-switcher {
        float: left;
        width: 100%;
      }

    </style>

    <template
      is="dom-if"
      if="[[ colorsData.length ]]">
      <div class="color-switcher">
        <div class="color-name">Color: [[ currentName ]]</div>

        <ul class="list-group">
          <template
            is="dom-repeat"
            items="[[ colorsData ]]"
            as="color">
            <li class$="list-group-item {{ _isCurrentColor(currentName, color.color_name) }}">
              <span on-tap="_changeCurrentColor"
                    role="button"
                    tabindex="0"
                    color-image$="[[ color.color_image ]]"
                    color-name$="[[ color.color_name ]]"
                    gtm-action$="[[ gtmAction ]]"
                    gtm-child$="[[ gtmChild ]]"
                    gtm-cta-index$="[[ index ]]"
                    style$="background-color: [[ color.color_code ]];"></span>
            </li>
          </template>
        </ul>

      </div>
    </template>
  </template>

  <script>
    Polymer({
      is: 'dorel-color-switcher',

      properties: {

        /**
         * @attribute
         * @name colorsData
         * @description holds all colors
         */
        colorsData: {
          type: Array,
          value: [],
          observer: '_colorsDataChanged'
        },

        /**
         * @attribute
         * @name currentImage
         * @description by default isset to the first array item
         */
        currentImage: {
          type: String,
          value: '',
          notify: true
        }

      },

      /**
       * @observer
       * @name _colorsDataChanged
       * @description when the colorsData changes it checks if it is set, then
       * sets the first item to the currentColorName and currentImage
       *
       * @param newVal - Array - the newly received array
       * @param oldVal - Array - the previous value
       */
      _colorsDataChanged: function (newVal, oldVal) {
        if (typeof newVal === 'undefined' || !newVal.length) return;

        this.currentImage = newVal[0].color_image;
        this.currentName = newVal[0].color_name;
      },

      /**
       * @onTap
       * @name _changeCurrentColor
       * @description when a color is clicked it will change the current values
       *
       * @param e - Object - the clicked object/target
       */
      _changeCurrentColor: function (event) {
        var element = Polymer.dom(event).localTarget;

        this.newColorImage = event.target.getAttribute('color-image');
        this.newColorName = event.target.getAttribute('color-name');

        this.gtmAction = event.target.getAttribute('gtm-action');
        this.gtmChild = event.target.getAttribute('gtm-child');
        this.gtmCtaIndex = event.target.getAttribute('gtm-cta-index');

        var structure = {
          name: this.gtmParent,
          index: Number(this.gtmParentIndex) + 1,
          child: {
            name: this.gtmChild,
            index: 1,
            event: {
              name: 'color-switch',
              colorName: this.newColorName,
              colorImage: this.newColorImage,
              index: Number(this.gtmCtaIndex) + 1,
            }
          }
        };
        
        Polymer.globalsManager.set('Dorel.events', {
          action: this.gtmAction ? this.gtmAction : 'click',
          component: 'color-switcher',
          structure: structure,
          element: element,
          event: 'polymer_event',
          things: {
            currentColor: this.currentName,
            targetColor: this.newColorName
          }
        });

        this.currentImage = this.newColorImage;
        this.currentName = this.newColorName;
      },

      /**
       * @name _isCurrentColor
       * @description check if the item is the current one to set the active
       * class on the list-item
       *
       * @param current - String - the current color name
       * @param name - String - the name of the color item
       * @returns String - active or empty string
       */
      _isCurrentColor: function (current, name) {
        return (current === name) ? 'active' : '';
      }
    });
  </script>

</dom-module>
