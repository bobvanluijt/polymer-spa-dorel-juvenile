<link rel="import" href="dorel-responsive-image.html">
<link rel="import" href="../utils/dorel-bynder-collect-media.html">
<dom-module id="dorel-bynder-image">
  <template>
    <style>
      :host {
        /* These can be overwritten in a encapsulating component */
        --bynder-image-width: 16em;
        --bynder-image-height: 9em;
      }

      iron-image {
        width: var(--bynder-image-width);
        height: var(--bynder-image-height);
        background-color: var(--theme-brand-color-1);
      }
    </style>

    <!-- Handles the ajax call and returns the bynder data -->
    <dorel-bynder-collect-media media-id="[[ mediaId ]]"
                                media-content="{{ mediaContent }}"></dorel-bynder-collect-media>
    <section class="section">
      <iron-image sizing="cover"
                  fade="true"
                  preload
                  placeholder$="[[ imagePlaceholder ]]"
                  src$="[[ imageSource ]]">
    </section>
  </template>

  <script>
    Polymer({
      is: 'dorel-bynder-image',
      properties: {
        /**
         * @name width
         * @description The width for displaying the image (set as a css property)
         */
        width: {
          type: String,
          value: '16em',
        },
        /**
         * @name height
         * @description The height for displaying the image (set as a css property)
         */
        height: {
          type: String,
          value: '9em',
        },
        /**
         * @name mediaId
         * @description The ID used to retrieve the asset from Bynder
         */
        mediaId: {
          type: String
        },
        /**
         * @name mediaContent
         * @description data coming from Bynder.
         */
        mediaContent: {
          type: Object,
          notify: true,
          observer: '_onMediaContentChanged'
        },
        /**
         * @name derivativeIdentifier
         * @description The identifier to retrieve the correct derivative
         */
        derivativeIdentifier: {
          type: String,
          value: ''
        },
        /**
         * @name imageSource
         * @description The source of the image to be displayed
         */
        imageSource: {
          type: String,
        },
        /**
         * @name imagePlaceholder
         * @description The image placeholder for the image
         */
        imagePlaceholder: {
          type: String,
        }
      },
      /**
       * @name _onMediaContentChanged
       * @description Retrieves the correct image source in the Bynder data
       */
      _onMediaContentChanged: function () {
        // Default to the root media thumbnail and webimage
        if (this.derivativeIdentifier === '') {
          this.imagePlaceholder = this.mediaContent.thumbnails.mini;
          this.imageSource = this.mediaContent.thumbnails.webimage;
        }
        // Retrieve the derivative if one is specified
        else {
          // TODO: check if mediaContent exists, and return the proper derivative path.
          // We still need more information on the derivative data to implement this correctly
        }
      },
      /**
       * @name _setSize
       * @description Sets the image size according to given width and height properties
       */
      _setSize: function () {
        this.updateStyles({
          '--bynder-image-width': this.width,
          '--bynder-image-height': this.height,
        });
      },
      /**
       * @name attached
       * @description Attached callback, sets the given image size
       */
      attached: function () {
        this._setSize();
      }
    });
  </script>
</dom-module>
