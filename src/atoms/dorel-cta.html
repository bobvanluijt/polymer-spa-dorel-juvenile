<dom-module id="dorel-cta">
  <template>
    <style include="iron-flex">

      .theme-cta {
        @apply(--theme-button);
        @apply(--theme-button-primary);
        @apply(--theme-button-small);
        width: 100%;
        margin-top: var(--button-margin-spacing, 1.5em) !important;
      }

      .theme-cta:hover, .theme-cta:focus {
        @apply(--theme-button-active);
        cursor: pointer;
      }

      .theme-cta--primary {
        @apply(--theme-button-primary);
      }

      .theme-cta--secondary {
        @apply(--theme-button-secondary);
      }

      .theme-cta--tertiary {
        @apply(--theme-button-tertiary);
      }

      .theme-cta--link {
        @apply(--theme-button-link);
      }

      .theme-cta--link .theme-cta__content {
        padding: 0;
      }

      .theme-cta--link .theme-cta__icon {
        padding-right: 0;
      }

      .theme-cta--link:hover, .theme-cta--link:focus {
        @apply(--theme-button-link-active);
      }

      .theme-cta--small {
        @apply(--theme-button-small);
      }

      .theme-cta--medium {
        @apply(--theme-button-medium);
      }

      .theme-cta--large {
        @apply(--theme-button-large);
      }

      .theme-cta__content {
        flex-grow: 1;
        padding: 0 0 0 0.75em;
      }

      .theme-cta__icon {
        @apply(--theme-button-icon);

      }

      .theme-cta__icon--left {
        width: 5.125em;
        height: 3.125em;
        margin: .475em 0;
      }

      [mobile-small] .theme-cta__icon--left {
        width: 3em;
        height: 2.5em;
        margin: 0;
      }

      .theme-cta--large[mobile-small] {
        height: 3em;
      }

      :host([disabled]) a {
        opacity: .35;
        pointer-events: none;
      }

      :host([disabled]) {
        cursor: not-allowed;
      }

    </style>

    <iron-media-query query="(max-width : 479px)"
                      query-matches="{{ mobileSmall }}"></iron-media-query>
    <iron-media-query query="(min-width : 480px) and (max-width : 767px)"
                      query-matches="{{ mobileMedium }}"></iron-media-query>

    <a href$="[[ link ]]"
       title$="[[ title ]]"
       target$="[[ target ]]"
       class$="theme-cta theme-cta--[[ type ]] theme-cta--[[ size ]]"
       mobile-small$="[[ mobileSmall ]]"
       mobile-medium$="[[ mobileMedium ]]"
       target$="[[ _isExternal(linkTarget) ]]"
       gtm-action$="[[ gtmAction ]]"
       gtm-parent$="[[ gtmParent ]]"
       gtm-parent-index$="[[ gtmParentIndex ]]"
       gtm-child$="[[ gtmChild ]]"
       gtm-child-index$="[[ gtmChildIndex ]]"
       gtm-cta-index$="[[ gtmCtaIndex ]]"
       on-tap="_clickCTA">

      <template
        is="dom-if"
        if="[[ extraIcon ]]">
        <iron-icon class="theme-cta__icon theme-cta__icon--left" icon="[[ extraIcon ]]"></iron-icon>
      </template>

      <span class="theme-cta__content"><content id="content"></content></span>

      <template
        is="dom-if"
        if="[[ icon ]]">
        <iron-icon class="theme-cta__icon" icon="[[ icon ]]"></iron-icon>
      </template>

    </a>
  </template>

  <script>
    Polymer({
      is: 'dorel-cta',

      properties: {

        /**
         * @attribute
         * @name link
         * @description defines the href of the CTA
         */
        link: {
          type: String
        },
        /**
         * @attribute
         * @name target
         * @description defines the target for the href
         */
        target: {
          type: String
        },
        /**
         * @attribute
         * @name title
         * @description defines the title attribut of the CTA, can be the same as it's content
         */
        title: {
          type: String
        },
        /**
         * @attribute
         * @name linkTarget
         * @description defines the links target (e.g. _blank for opening in new tab)
         */
        linkTarget: {
          type: String,
          value: ''
        },

        /**
         * @attribute
         * @name type
         * @description defines what type of CTA we are dealing with. Currently 'primary', 'secondary' and 'tertiary' are supported.
         */
        type: {
          type: String,
          value: 'primary',
        },

        /**
         * @attribute
         * @name size
         * @description defines the size of the CTA. Currently 'small', 'medium' and 'large' are supported
         */
        size: {
          type: String,
          value: 'small'
        },

        /**
         * @attribute
         * @name icon
         * @description The icon for the CTA. Use the dorel-iconset icons here.For example: dorel-icons:chevron-right
         */
        icon: {
          type: String,
          value: 'dorel-icons:chevron-right',
        },

        /**
         * @attribute
         * @name extraIcon
         * @description A large extra icon for emphasizing the CTA. Is placed left of the text.
         * Use the dorel-iconset icons here. For example: dorel-icons:chevron-right
         */
        extraIcon: {
          type: String,
        }
      },

      /**
       * @name clickCTA
       * @description handle the click on a cta link, very important for Analytics!!!!!!
       */
      _clickCTA: function (event) {
        if (Polymer.dom(event).rootTarget.tagName === 'A') {
          var element = Polymer.dom(event).rootTarget;
        } else {
          var element = Polymer.dom(event).path[1];
        }

        var gtmAction = element.getAttribute('gtm-action');

        var component = {
          name: this.gtmParent,
          index: Number(this.gtmParentIndex) + 1
        };

        if (typeof this.gtmChild !== 'undefined' && this.gtmChild !== null) {
          component.child = {
            name: this.gtmChild,
            index: Number(this.gtmChildIndex) + 1,
            event: {
              name: 'call-to-action',
              type: this.type,
              text: this.$.content.getDistributedNodes()[0].textContent,
              index: Number(this.gtmCtaIndex) + 1,
            }
          }
        } else {
          component.event = {
            name: 'call-to-action',
            type: this.type,
            text: this.$.content.getDistributedNodes()[0].textContent,
            index: Number(this.gtmCtaIndex) + 1
          }
        }
        
        /**
         * Tracking on click for cta
         */
        Polymer.globalsManager.set('Dorel.events', {
          action: this.gtmAction ? this.gtmAction : 'click',
          component: component,
          element: element,
          event: 'polymer_event',
          things: {
            'currentPage': document.URL,
            'targetPage': element.href
          }
        });
      },

      /**
       * @name _isExternal
       * @description define if the target opens in a new tab or not
       */
      _isExternal: function (linkTarget) {
        return (typeof linkTarget === 'undefined' || !linkTarget) ?
          '_self' : '_blank';
      }
    });
  </script>

</dom-module>
