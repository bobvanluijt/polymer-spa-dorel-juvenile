<dom-module id="dorel-section-downloads">
  <template>
    <style include="iron-flex iron-flex-alignment">
      :host {
        --iron-image-placeholder: var(--image-placeholder);
      }
      .container {
        padding: var(--theme-component-space-inner);
      }

      .title {
        @apply(--theme-heading);
        font-size: var(--theme-size-headline);
        margin: 0 0 var(--theme-component-space-micro) 0;
        text-align: center;
        width: 100%;
      }

      .downloads {
        @apply(--layout-flex);
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
        @apply(--layout-wrap);
      }

      .downloads__item {
        padding: var(--theme-component-space-inner);
        text-align: center;

      }

      .downloads__item__label {
        text-decoration: none;
        color: var(--theme-color-link-primary);
        cursor: pointer;
        transition: color .3s ease;
      }

      .downloads__item__image {
        width: 12rem;
        height: 8rem;
        opacity: .75;
        margin: 0 auto 1rem auto;
        display: block;
        transition: opacity .3s ease;
      }

      .downloads__item:hover, .downloads__item:focus {
        cursor: pointer;
      }

      .downloads__item:hover .downloads__item__image, .downloads__item:focus .downloads__item__image{
        opacity: .5;
      }

      .downloads__item:hover .downloads__item__label, .downloads__item:focus .downloads__item__label {
        color: var(--theme-color-text-link-active);
      }

    </style>
  

    <template
      is="dom-if"
      if="[[ downloadsData.downloads.length ]]">
      <section class="container">
        <h2 class="title">[[ downloadsData.downloads_title ]]</h2>
        <div class="downloads">
          <template
            is="dom-repeat"
            items="[[ downloadsData.downloads ]]"
            as="download">

            <div class="downloads__item" role="button" tabindex="0"
              data-file$="[[ download.download_file ]]"
              on-click="_clickDownload">
              <iron-image class="downloads__item__image"
                sizing="cover"
                fade="true"
                preload
                src$="[[ download.download_image ]]">
              </iron-image>
              <iron-icon icon="dorel-icons:file-download"></iron-icon>
              <span class="downloads__item__label">[[ download.download_text ]]</span>
            </div>
          
          </template>
        </div>
      </section>
    </template>
  </template>

  <script>
    Polymer({
      is: 'dorel-section-downloads',
      properties: {
        /**
         * @attribute
         * @name downloadsData
         * @description data retrieved from ACF/Wordpress to build up this page
         */
        downloadsData: {
          type: Object,
          value: function() {
            return {};
          }
        }
      },

      /**
       * @name _clickDownload
       * @description handle of the click on the download links
       */
      _clickDownload: function(event) {
        window.open(event.currentTarget.getAttribute('data-file'), '_blank');

        // track the event
        this._eventTracking(event);

      },

      /**
       * @name _eventTracking
       * @description this is for cta tracking only 
       * more info http://bit.ly/2nb6I7G
       */
      _eventTracking: function(event) {

        var globals = Polymer.globalsManager.get('Dorel');

        /** 
         * Tracking on click for cta
         */
        Polymer.globalsManager.set('Dorel.events', {
          action: 'click',
          component: 'downloads',
          element: Polymer.dom(event).localTarget,
          event: 'polymer_event',
          things: {
            downloadFile: event.currentTarget.getAttribute('data-file')
          }
        });
      }
    });
  </script>
</dom-module>
