<link rel="import" href="../../bower_components/l2t-paper-slider/l2t-paper-slider.html">


<dom-module id="dorel-section-slideshow">
  <template>
    <style include="polymer-bootstrap-min">
      .section-slideshow {}
      .section-slideshow {
        position: relative;
      }
      .section-slideshow .simple-slider {
        width: 100%;
        height: 612px;
      }

      .section-slideshow .simple-slider-slide {
        background-position: center center;
        background-repeat: no-repeat;
        background-size: cover;
        width: 100%;
        height: 603px;
      }

    </style>


    <!-- media queries -->
    <iron-media-query query="(max-width : 479px)" 
      query-matches="{{ mobileSmall }}"></iron-media-query>
    <iron-media-query query="(min-width : 480px) and (max-width : 767px)" 
      query-matches="{{ mobileMedium }}"></iron-media-query>
    <iron-media-query query="(min-width : 768px) and (max-width : 991px)"
      query-matches="{{ tablets }}"></iron-media-query>
    <iron-media-query query="(min-width : 992px) and (max-width : 1199px)" 
      query-matches="{{ desktopSmall }}"></iron-media-query>
    <iron-media-query query="(min-width : 1200px)" 
      query-matches="{{ desktopFull }}"></iron-media-query>
    
    <template
      is="dom-if"
      if="[[ slideshowData ]]">

      <section
        class$="section-slideshow {{ isFullWidth(slideshowData.slideshow_width) }}"
        mobile-small$="{{ mobileSmall }}"
        mobile-medium$="{{ mobileMedium }}"
        tablets$="{{ tablets }}"
        desktop-small$="{{ desktopSmall }}"
        desktop-full$="{{ desktopFull }}">
        <div class="row">
          <div class="col-xs-12">

            <!-- simple-slider -->
            <l2t-paper-slider class="simple-slider"
                              auto-progress
                              slide-duration="4"
                              total-slides="[[ slideshowData.slideshow_slides.length ]]">
              <template
                is="dom-repeat"
                items="[[ slideshowData.slideshow_slides ]]"
                as="slide">

                <paper-slide class="simple-slider-slide"
                  style$="
                    background-image: url([[ hasBackgroundImage(slide.slide_image) ]]);"></paper-slide>

              </template>
            </l2t-paper-slider>

          </div>
        </div>
      </section>

    </template>
  </template>

  <script>
    Polymer({
      is: 'dorel-section-slideshow',

      properties: {

        /**
         * @attribute
         * @name slideshowData
         * @description data coming from ACF/Wordpress to build up the component
         */
        slideshowData: {
          type: Object,
          value: function() {
            return {};
          }
        }

      },

      /**
       * @name isFullWidth
       * @description defines if the container is full-width or fixed-width
       *
       * @returns String if it is full width 'container-fluid' will be returned
       * otherwise it will be 'container'
       */
      isFullWidth: function(container) {
        return (typeof container === '' || container === 'undefined' || container === 'full-width') ? 'container-fluid' : 'container';
      },

      /**
       * @name hasBackgroundImage
       * @description checks to see if an image is set for the slide
       *
       * @returns String if it a background image is defined otherwise it returns
       * a placeholder url
       */
      hasBackgroundImage: function(bgImage) {
        return (typeof bgImage === 'undefined' || bgImage === '' || !bgImage) ? '/assets/images/placeholders/slideshow/placeholder.jpg' : bgImage;
      },

      /**
       * @name prevSlide
       * @description handles what should happen when the previous button is clicked
       */
      prevSlide: function(event) {

        // call the prev() function of simple-slider
        this.$$('simple-slider').prev();

        // track the event
        this._eventTracking(event, 'previous');

      },

      /**
       * @name nextSlide
       * @description handles what should happen when the next button is clicked
       */
      nextSlide: function(event) {
        
        // call the next() function of simple-slider
        this.$$('simple-slider').next();

        // track the event
        this._eventTracking(event, 'next');
      },

      /**
       * @name _eventTracking
       * @description this is for cta tracking only
       * more info http://bit.ly/2nb6I7G
       */
      _eventTracking: function(event, type) {

        var globals = Polymer.globalsManager.get('Dorel');

        /** 
         * Tracking on click for cta
         */
        Polymer.globalsManager.set('Dorel.events', {
          action: type,
          component: 'slideshow',
          element: Polymer.dom(event).localTarget,
          event: 'polymer_event'
        });
      }
    });
  </script>
</dom-module>
