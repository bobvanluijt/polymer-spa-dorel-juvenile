<dom-module id="dorel-section-related-accessoiries">
  <template>
    <style include="iron-flex iron-flex-alignment">
      .section-related-accessories {
        padding: var(--theme-component-space-inner);
        @apply(--layout-flex);
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
        @apply(--layout-wrap);
      }

      .column-headline {
        @apply(--theme-heading);
        font-size: var(--theme-size-display1);
        margin: 0;
        text-align: center;
      }

      .accessory-title {
        @apply(--theme-heading);
        text-align: center;
        margin: var(--theme-component-space-micro) 0 0 0;
      }

      .accessory-wrap {
        @apply(--layout-flex);
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
        @apply(--layout-wrap);

      }

      .accessory {
        padding: var(--theme-component-space-inner);
        text-align: center;
      }

      .accessory a {
        text-decoration: none;
        color: var(--theme-color-link-primary);
        transition: .3s ease color;
      }

      .accessory a:hover, .accessory a:focus {
        color: var(--theme-color-hover);
      }

      .accessories {
        padding: var(--theme-component-space-inner);
      }

    </style>

    <section class="section-related-accessories">
      <template
        is="dom-if"
        if="[[ relAccData.included_accessoiries.length ]]">
          <div class="accessories">
            <h2 class="column-headline">Included Accessories</h2>
            <div class="accessory-wrap">
              <template
                is="dom-repeat"
                items="[[ relAccData.included_accessoiries ]]"
                as="accessory">
                <div class="accessory">
                  <img class="img-responsive" src="[[ hasAccessoiryImage(accessory.accessoiry_image) ]]" alt="" width="185" height="185" />
                  <h4 class="accessory-title">[[ accessory.accessoiry_title ]]</h4>
                </div>
              </template>
            </div>
          </div>
      </template>

      <template
        is="dom-if"
        if="[[ relAccData.optional_accessoiries.length ]]">
          <div class="accessories">
            <h2 class="column-headline">Optional Accessories</h2>
            <div class="accessory-wrap">
              <template
                is="dom-repeat"
                items="[[ relAccData.optional_accessoiries ]]"
                as="accessory">
                <div class="accessory">
                  <img class="img-responsive" src="[[ hasAccessoiryImage(accessory.accessoiry_image) ]]" alt="" width="185" height="185" />
                  <h4 class="accessory-title">[[ accessory.accessoiry_title ]]</h4>
                  <a href="#"
                    on-click="clickDetails">
                    See details <iron-icon class="chevron" icon="dorel-icons:chevron-right"></iron-icon>
                  </a>
                </div>
              </template>
            </div>
          </div>
      </template>
    </section>
  </template>

  <script>

    Polymer({
      is: 'dorel-section-related-accessoiries',

      properties: {

        /**
         * @attribute
         * @name relAccData
         * @description data retrieved from ACF/Wordpress to build up this page
         */
        relAccData: {
          type: Object,
          value: function() {
            return {};
          }
        }

      },

      /**
       * @name hasAccessoiryImage
       * @description checks to see if a accessoiry image has been set in Wordpress
       *
       * @returns String if no image is it will use a placeholder image
       */
      hasAccessoiryImage: function(img) {
        return (typeof img === 'undefined' || img === '' || !img) ? '/assets/images/placeholders/related/placeholder.jpg' : img;
      },
      
      /**
       * @name clickDetails
       * @description handle of the click on the details links
       */
      clickDetails: function(event) {

        // track the event
        this._eventTracking(event);

      },

      /**
       * @name _eventTracking
       * @description this is for cta tracking only 
       * more info http://bit.ly/2nb6I7G
       */
      _eventTracking: function(event) {

        var globals = Polymer.globalsManager.get('Dorel');

        /** 
         * Tracking on click for cta
         */
        Polymer.globalsManager.set('Dorel.events', {
          action: 'click',
          component: 'related-accessories',
          element: Polymer.dom(event).localTarget,
          event: 'polymer_event',
          things: {
            'currentPage': document.URL,
            'targetPage': Polymer.dom(event).localTarget.href
          }
        });
      }
    });

  </script>

</dom-module>
