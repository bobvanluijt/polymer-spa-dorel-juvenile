<link rel="import" href="../atoms/dorel-bynder-image.html">
<link rel="import" href="../atoms/dorel-bynder-responsive-image.html">
<link rel="import" href="../molecules/dorel-youtube-video.html">
<link rel="import" href="../molecules/dorel-youtube-lightbox.html">

<dom-module id="dorel-section-hero-header">
  <template>
    <style>
      :host {
        float: left;
        width: 100%;
        --image-background-color: var(--theme-brand-color-1);
        --content-align: right;
      }

      .hero-header {
        @apply(--layout-vertical);
        width: 100%;
        justify-content: center;
        position: relative;
      }

      .title {
        @apply(--theme-typography-6);
        color: var(--theme-color-white);
        margin: 0;
        text-shadow: var(--theme-text-shadow);
        max-width: 800px;
        display: inline-block;
      }

      .subtitle {
        @apply(--theme-typography-4);
        font-weight: var(--theme-font-weight-light);
        margin-top: 0;
        color: var(--theme-color-white);
        text-shadow: var(--theme-text-shadow);
      }

      dorel-cta {
        display: inline-block;
        width:auto;
        margin-top: 1.5em;
      }

      dorel-layout-container {
        position: absolute;
        right: 0;
        left: 0;
        top: 0;
        height: 100%;
      }

      dorel-layout-row {
        position: relative;
        height: 100%;
      }

      dorel-layout-column {
        position: absolute;
        bottom: 3em;
        width: 100%;
        text-align: var(--content-align);
      }

      [tablet-small] .title {
        @apply(--theme-typography-7);
        margin-top: 0;
      }

      [tablet-small] .subtitle {
        @apply(--theme-typography-5);
        font-weight: var(--theme-font-weight-light);
        margin-top: 0;
      }

      [tablet-medium-up] dorel-layout-column {
        margin-top: 0;
        bottom: 25%;
      }

      [tablet-medium-up] .title {
        @apply(--theme-typography-8);
        font-size: 3.75em;
        margin-top: 0;
      }

      [tablet-medium-up] .subtitle {
        @apply(--theme-typography-6);
        font-weight: var(--theme-font-weight-light);
        margin-top: .375em;
      }
    </style>

    <dorel-media-query breakpoints="{{ breakpoints }}"></dorel-media-query>
    <section class="hero-header"
             tablet-small$="[[ breakpoints.tabletSmall ]]"
             tablet-medium-up$="[[ breakpoints.tabletMediumUp ]]">

      <!-- Show video on larger screens -->
      <template is="dom-if" if="[[ breakpoints.tabletMediumUp ]]">
        <!-- Show video in header if there is a video -->
        <template is="dom-if" if="[[ showVideoLoop ]]">
          <dorel-youtube-video video-id="[[ heroHeaderData.looping_video_id ]]"
                               thumbnail="[[ heroHeaderData.bynder_background_image ]]"
                               autoplay="1"
                               is-hero="true"></dorel-youtube-video>
        </template>

        <!-- Show image in header if there is no video -->
        <template is="dom-if" if="[[ !showVideoLoop ]]">
          <dorel-bynder-responsive-image
            media-id="[[ heroHeaderData.bynder_background_image ]]"></dorel-bynder-responsive-image>
        </template>
      </template>

      <!-- Don't show video on smaller screens, just the image -->
      <template is="dom-if" if="{{ !breakpoints.tabletMediumUp }}">
        <dorel-bynder-responsive-image
          media-id="[[ heroHeaderData.bynder_background_image ]]"></dorel-bynder-responsive-image>
      </template>

  <dorel-layout-container>
    <dorel-layout-row>
      <dorel-layout-column desktop-column-span="12" tablet-column-span="12" mobile-column-span="12">
        <header>
          <template is="dom-if" if="[[ heroHeaderData.title ]]">
            <h3 class="title">[[ heroHeaderData.title ]]</h3>
          </template>
          <template is="dom-if" if="[[ heroHeaderData.sub_title ]]">
            <p class="subtitle">[[ heroHeaderData.sub_title ]]</p>
          </template>
          <template is="dom-if" if="[[ showTextCta ]]">
            <div>
              <dorel-cta
                title="[[ heroHeaderData.cta_text ]]"
                icon="dorel-icons:chevron-right"
                type="primary"
                link="[[ heroHeaderData.cta_href ]]"
                gtm-parent="[[ gtmParent ]]"
                gtm-parent-index="[[ gtmParentIndex ]]"
                gtm-cta-index="0">
                [[ heroHeaderData.cta_text ]]
              </dorel-cta>
            </div>
          </template>
          <template is="dom-if" if="[[ showVideoCta ]]">
            <div>
              <dorel-cta
                icon="dorel-icons:play-circle-outline"
                type="primary"
                link=""
                on-click="openYouTubeLightbox"
                gtm-parent="[[ gtmParent ]]"
                gtm-parent-index="[[ gtmParentIndex ]]"
                gtm-cta-index="0">
                {{ localize('Watch_video') }}
              </dorel-cta>
            </div>
          </template>
        </header>
      </dorel-layout-column>
    </dorel-layout-row>
  </dorel-layout-container>
  </section>
  <dorel-youtube-lightbox video_id="[[ heroHeaderData.cta_video_id ]]" gtm-action="[[ gtmAction ]]" gtm-parent="[[ gtmParent ]]" gtm-parent-index="[[ gtmParentIndex ]]" gtm-child="[[ gtmChild ]]" gtm-child-index="[[ gtmChildIndex ]]" gtm-cta-index="0">
  </dorel-youtube-lightbox>
  </template>
  <script>
    Polymer({
      is: 'dorel-section-hero-header',

      properties: {
        /**
         * @attribute
         * @name heroHeaderData
         * @description all data defined by ACF/Wordpress to build this component
         */
        heroHeaderData: {
          type: Object,
          value: function() {
            return {};
          }
        },

        /**
         * @attribute
         * @name align
         * @description
         */
        align: {
          type: String,
          value: 'right',
          observer: '_setAlignment'
        },

        /**
         * @name showVideoCta
         * @description show the 'Watch video' button if a cta_video_id is provided
         */
        showVideoCta: {
          type: Boolean,
          computed: '_hasVideoCTA(heroHeaderData)'
        },

        /**
         * @name showTextCta
         * @description show the cta button if a cta_text and cta_href are provided
         */
        showTextCta: {
          type: Boolean,
          computed: '_hasTextCTA(heroHeaderData)'
        },

        /**
         * @name showVideoLoop
         * @description show the looping video if toggle is set and a video_id is provided
         */
        showVideoLoop: {
          type: Boolean,
          computed: '_hasVideoLoop(heroHeaderData)'
        }

      },

      behaviors: [ConditionalBehaviors, DorelMultilingualBehavior],

      /**
       * @name _hasVideoCTA
       * @description Test for cta_video_id
       */
      _hasVideoCTA: function(data) {
        return !!(data.cta_toggle &&  data.cta_type === "cta-video" && data.cta_video_id);
      },

      /**
       * @name _hasTextCTA
       * @description Test for cta_text and cta_href
       */
      _hasTextCTA: function(data) {
        return !!(data.cta_toggle && data.cta_type !== 'cta-video' && data.cta_text && data.cta_href);
      },

      /**
       * @name _hasVideoLoop
       * @description use the align attribute to set style property
       */
      _hasVideoLoop: function (data) {
        return !!(data.looping_video_toggle && data.looping_video_id);
      },

      /**
       * @name _setAlignment
       * @description use the align attribute to set style property
       */
      _setAlignment: function(align) {
        if(align ==='left' || align === 'right') {
          this.updateStyles({'--content-align': align});
        }
      },

      /**
       * @name openYouTubeLightbox
       * @description open a ligthbox with a You-Tube video
       */
      openYouTubeLightbox: function(event) {
        var youtubeLigthbox = this.$$('dorel-youtube-lightbox');
        youtubeLigthbox.open();
      }
    });
  </script>
</dom-module>
