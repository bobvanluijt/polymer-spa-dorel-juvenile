<dom-module id="dorel-section-cta">
  <template>
    <style include="iron-flex iron-flex-alignment">
      .section-cta {
        display: flex;
        width: 100%;
        position: relative;
        z-index: 1;
      }

      .cta-item {
        display: flex;
        flex: 1;
      }

      .cta-item-link {
        @apply(--theme-heading);
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
        font-size: var(--theme-size-subhead);
        flex: 1;
        background-color: var(--theme-brand-color);
        color: var(--theme-white);
        text-decoration: none;
        transition: .3s ease background-color;
        min-height: 184px;
      }

      .cta-item-link:hover, .cta-item-link:focus {
        background-color: var(--theme-color-hover);
      }

      .cta-item-img {
        flex: 1;
        background-position: center center;
        background-repeat: no-repeat;
        background-size: cover;
        min-height: 184px;
      }

      .chevron {
        margin-top: 4px;
        --iron-icon-height: 1.25em;
        --iron-icon-width: 1.25em;
      }

      /* Responsive behaviour */
      .section-cta[mobile-small] , .section-cta[mobile-medium] {
        display: block;
      }

      [mobile-small] .cta-item, [mobile-medium]  .cta-item{
        display: flex;
        width: 100%;
      }

      [mobile-small] .cta-item:nth-child(odd) .cta-item-link, [mobile-medium]  .cta-item:nth-child(odd) .cta-item-link {
        order: 1;
      }
    </style>
    
    <!-- media queries -->
    <iron-media-query query="(max-width : 479px)" 
      query-matches="{{ mobileSmall }}"></iron-media-query>
    <iron-media-query query="(min-width : 480px) and (max-width : 767px)" 
      query-matches="{{ mobileMedium }}"></iron-media-query>
    
    <section class="section-cta" mobile-small$="{{ mobileSmall }}" mobile-medium$="{{ mobileMedium }}">
        <template
          is="dom-repeat"
          items="[[ ctaData.cta ]]"
          as="cta">
          <div class="cta-item">
            <a class="cta-item-link"  href="[[ cta.cta_link ]]" on-click="clickCTA">
              [[ cta.cta_text ]] <iron-icon class="chevron" icon="dorel-icons:chevron-right"></iron-icon>
            </a>
            <div class="cta-item-img" style$="background-image: url([[ hasBackgroundImage(cta.cta_image) ]]);"></div>
          </div>
        </template>

    </section>
  </template>

  <script>
    Polymer({
      is: 'dorel-section-cta',

      properties: {

        /**
         * @attribute
         * @name ctaData
         * @description all data needed for this CTA defined in ACF/Wordpress
         */
        ctaData: {
          type: Object,
          value: function() {
            return {};
          }
        }

      },

      /**
       * @name hasBackgroundImage
       * @description check if a background-image is defined or not. If no image is set we need to
       * show a placeholder image
       */
      hasBackgroundImage: function(img) {
        return (typeof img === 'undefined' || img === '' || !img) ? '/assets/images/placeholders/cta/placeholder.jpg' : img;
      },

      /**
       * @name clickCTA
       * @description handle the click event of the CTA
       */
      clickCTA: function(event) {

        // Track the click event
        this._eventTracking(event);
      },

      /**
       * @name _eventTracking
       * @description this is for cta tracking only 
       * more info http://bit.ly/2nb6I7G
       */
      _eventTracking: function(event) {

        var globals = Polymer.globalsManager.get('Dorel');

        /** 
         * Tracking on click for cta
         */
        Polymer.globalsManager.set('Dorel.events', {
          action: 'switch',
          component: 'call-to-action',
          element: Polymer.dom(event).localTarget,
          event: 'polymer_event',
          things: {
            'currentPage': document.URL,
            'targetPage': Polymer.dom(event).localTarget.href
          }
        });
      }
    });

  </script>

</dom-module>
