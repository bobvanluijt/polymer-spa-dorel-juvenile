<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/iron-scroll-target-behavior/iron-scroll-target-behavior.html">
<link rel="import" href="../molecules/dorel-multilingual-select-language.html">
<link rel="import" href="../molecules/dorel-logo.html">
<link rel="import" href="../molecules/dorel-navigation-main.html">

<dom-module id="dorel-header">
  <template>
    <style include="iron-flex iron-flex-alignment">
      .header-wrapper {
        height: 4.5em;
        float: left;
        width: 100%;
        display: block;
      }

      header {
        transition: transform .3s ease;
        position: relative;
        float: left;
        width: 100%;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 10000;
        width: 100%;
        background-color: white;
      }

      header::before {
        content: "";
        position: absolute;
        bottom: -.75em;
        left: 0;
        height: .75em;
        z-index: 2;
        width: 100%;

        /* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#000000+0,000000+100&0.13+0,0+100 */
        background: -moz-linear-gradient(top, rgba(0, 0, 0, 0.13) 0%, rgba(0, 0, 0, 0) 100%); /* FF3.6-15 */
        background: -webkit-linear-gradient(top, rgba(0, 0, 0, 0.13) 0%, rgba(0, 0, 0, 0) 100%); /* Chrome10-25,Safari5.1-6 */
        background: linear-gradient(to bottom, rgba(0, 0, 0, 0.13) 0%, rgba(0, 0, 0, 0) 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#21000000', endColorstr='#00000000', GradientType=0); /* IE6-9 */
      }

      .header-items {
        @apply(--max-width-container);
        @apply(--layout-vertical);
        background-color: var(--theme-color-white);
        box-sizing: border-box;
        transition: .15s ease padding;
        padding: .75em;
        position: relative;
      }

      .header-item-menu {
        order: 1;
      }

      .header-toolbar {
        float: left;
        width: 100%;
        height: 3em;
        background-color: var(--theme-color-monochrome-2);
      }

      .header-toolbar-container {
        @apply(--max-width-container);
        padding: 0 var(--theme-gutter);
        box-sizing: border-box;
      }

      .header-toolbar-container dorel-multilingual-select-language {
        float: right;
      }

      .mobile-multi-language {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        z-index: 1001;
      }

      .mobile-multi-language-container {
        float: left;
        width: 100%;
        height: 3em;
        background-color: var(--theme-color-monochrome-2);
        position: absolute;
        bottom: 0;
        padding: 0 var(--theme-gutter-mobile);
        box-sizing: border-box;
      }

      .mobile-multi-language-container dorel-multilingual-select-language {
        float: right;
      }

      #hamburger {
        position: absolute;
        top: 1.25em;
        right: .75em;
        z-index: 1000;
        color: var(--theme-color-text-link);
        cursor: pointer;
        transition: .3s ease color, .15s ease top;
      }

      #hamburger:hover, #hamburger:focus {
        color: var(--theme-color-text-link-active);
      }

      .icon-toggle-menu {
        width: 1.25em;
        height: 1.25em;
        font-size: 1.5rem;
      }

      .header-item-logo {
        order: 4;
        /* center the logo */
        @apply(--layout-horizontal);
      }

      /* Compact Menu */
      /*[compact-menu] .header-items {
        padding: 0em .75em;
      }

      [compact-menu][desktop-small-up] .header-items {
        padding: 0 1.5em;
      }

      [compact-menu] #hamburger {
        top: 0.5em;
      } */

      [desktop-small-up][compact-menu] header {
        transform: translateY(-3em);
      }

      /* Responsive Behaviour */
      [tablet-medium-up] .header-items {
        padding-left: 1.5em;
        padding-right: 1.5em;
      }

      [tablet-medium-up] #hamburger {
        top: 2em;
        right: 1.25em;
      }

      /*[compact-menu][tablet-medium-up] #hamburger {
        top: 1.25em;
      }*/

      .header-wrapper[desktop-small-up] {
        height: 10.5em;
      }

      [desktop-small-up] .header-item-logo {
        order: 1;
        flex: 1;
      }

      [desktop-small-up] .header-item-menu {
        @apply(--layout-wrap);
        order: 4;
        padding: .75em 0;
      }

      [desktop-small-up] .header-items {
        /* layout horizontal header-main */
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
        padding: 1.5em;
      }

      [desktop-small-up] .header-contain-main-elements {
        @apply(--layout-horizontal);
        @apply(--layout-justified);
      }
    </style>

    <dorel-media-query breakpoints="{{ breakpoints }}"></dorel-media-query>
    <div class="header-wrapper"
         tablet-medium-up$="[[ breakpoints.tabletMediumUp ]]"
         desktop-small-up$="[[ breakpoints.desktopSmallUp ]]"
         compact-menu$="[[ compactMenu ]]">
      <header>
        <div class="desktop-header">
          <template is="dom-if" if="[[ breakpoints.desktopSmallUp ]]">
            <div class="header-toolbar">
              <div class="header-toolbar-container">
                <dorel-multilingual-select-language current-language="{{ currentLanguage }}"
                                                    continents-data="[[ continentsData ]]"></dorel-multilingual-select-language>
              </div>
            </div>
          </template>

          <div class="header-items">
            <div class="header-item header-item-logo">
              <div>
                <a href="/" aria-label="Maxi Cosi"
                   on-click="_logoClicked">
                  <dorel-logo brand-name="[[ brandName ]]"></dorel-logo>
                </a>
              </div>
            </div>

            <nav class="header-item header-item-menu">
              <dorel-navigation-main
                compact-menu="[[ compactMenu ]]"
                sub-menu-opened="{{ subMenuOpened }}"
                mobile-menu-opened="{{ mobileMenuOpened }}"></dorel-navigation-main>
            </nav>

            <template is="dom-if" if="{{ !breakpoints.desktopSmallUp }}">
              <template is="dom-if" if="{{ mobileMenuOpened }}">
                <div class="mobile-multi-language">
                  <div class="mobile-multi-language-container">
                    <dorel-multilingual-select-language current-language="{{ currentLanguage }}"
                                                        continents-data="[[ continentsData ]]"></dorel-multilingual-select-language>
                  </div>
                </div>
              </template>
              <div id="hamburger">
                <template
                  is="dom-if"
                  if="{{ !mobileMenuOpened }}">
                  <iron-icon class="icon-toggle-menu"
                             icon="dorel-icons:menu"
                             on-click="_toggleMobileMenu"
                             aria-label="menu"></iron-icon>
                </template>
                <template
                  is="dom-if"
                  if="{{ mobileMenuOpened }}">
                  <iron-icon class="icon-toggle-menu"
                             icon="dorel-icons:close"
                             on-click="_toggleMobileMenu"
                             aria-label="menu"></iron-icon>
                </template>
              </div>
            </template>
          </div>
        </div>
      </header>
    </div>
  </template>
  <script>
    Polymer({
      is: 'dorel-header',
      behaviors: [
        Polymer.IronScrollTargetBehavior
      ],
      properties: {
        /**
         * @name currentLanguage
         * @description Object containing currently selected country and language
         * TODO: This is temporarily filled with  dummy data, connect to API later
         */
        'currentLanguage': {
          type: Object,
          value: {
            'country': 'Belgium',
            'language': 'Dutch',
            'countryCode': 'be',
          }
        },
        /**
         * @name continentsData
         * @description Object containing the continents (and country, language data)
         * TODO: This is temporarily filled with  dummy data, connect to API later
         */
        continentsData: {
          type: Array,
          value: [{
            'title': 'Europe', 'countries': [
              {
                'countryCode': 'at',
                'title': 'Austria',
                'languages': [
                  {'language': 'German', 'id': 0},
                ]
              }, {
                'countryCode': 'be',
                'title': 'Belgium',
                'languages': [
                  {'language': 'Dutch', 'id': 0},
                  {'language': 'French', 'id': 1},
                ]
              }, {
                'countryCode': 'cz',
                'title': 'Czech Republic',
                'languages': [
                  {'language': 'Czech', 'id': 0}
                ]
              }
            ]
          },
            {
              'title': 'North America', 'countries': [
              {
                'countryCode': 'ca',
                'title': 'Canada',
                'languages': [
                  {'language': 'English', 'id': 0},
                  {'language': 'French', 'id': 1},
                ]
              }, {
                'countryCode': 'mx',
                'title': 'Mexico',
                'languages': [
                  {'language': 'Spanish', 'id': 0},
                ]
              }, {
                'countryCode': 'us',
                'title': 'United States',
                'languages': [
                  {'language': 'English', 'id': 0},
                ]
              }
            ]
            },
            {
              'title': 'South America', 'countries': [
              {
                'countryCode': 'at',
                'title': 'Austria',
                'languages': [
                  {'language': 'German', 'id': 0},
                ]
              }, {
                'countryCode': 'be',
                'title': 'Belgium',
                'languages': [
                  {'language': 'Dutch', 'id': 0},
                  {'language': 'French', 'id': 1},
                ]
              }, {
                'countryCode': 'cz',
                'title': 'Czech Republic',
                'languages': [
                  {'language': 'Czech', 'id': 0}
                ]
              }
            ]
            },
            {
              'title': 'Asia Pacific', 'countries': [
              {
                'countryCode': 'at',
                'title': 'Austria',
                'languages': [
                  {'language': 'German', 'id': 0},
                ]
              }, {
                'countryCode': 'be',
                'title': 'Belgium',
                'languages': [
                  {'language': 'Dutch', 'id': 0},
                  {'language': 'French', 'id': 1},
                ]
              }, {
                'countryCode': 'cz',
                'title': 'Czech Republic',
                'languages': [
                  {'language': 'Czech', 'id': 0}
                ]
              }
            ]
            },
            {
              'title': 'Middle East', 'countries': [
              {
                'countryCode': 'at',
                'title': 'Austria',
                'languages': [
                  {'language': 'German', 'id': 0},
                ]
              }, {
                'countryCode': 'be',
                'title': 'Belgium',
                'languages': [
                  {'language': 'Dutch', 'id': 0},
                  {'language': 'French', 'id': 1},
                ]
              }, {
                'countryCode': 'cz',
                'title': 'Czech Republic',
                'languages': [
                  {'language': 'Czech', 'id': 0}
                ]
              }
            ]
            },
            {
              'title': 'Africa', 'countries': [
              {
                'countryCode': 'at',
                'title': 'Austria',
                'languages': [
                  {'language': 'German', 'id': 0},
                ]
              }, {
                'countryCode': 'be',
                'title': 'Belgium',
                'languages': [
                  {'language': 'Dutch', 'id': 0},
                  {'language': 'French', 'id': 1},
                ]
              }, {
                'countryCode': 'cz',
                'title': 'Czech Republic',
                'languages': [
                  {'language': 'Czech', 'id': 0}
                ]
              }
            ]
            }]
        },
        /**
         * @attribute
         * @name compactMenu
         * @description Makes the menu compact
         */
        compactMenu: {
          type: Boolean,
          value: false,
        },
        /**
         * @attribute
         * @name brandName
         * @description defines the brand of the page
         */
        brandName: {
          type: String
        },

        /**
         * @attribute
         * @name loadComplete
         * @description is set within the dorel-app when all info is loaded
         */
        loadComplete: {
          type: Boolean
        },

        /**
         * @attribute
         * @name page
         * @description defines the current page in string format
         */
        page: {
          type: String
        },

        /**
         * @exposed
         * @name submenuOpened
         * @description defines if one of the submenu's should be opened or closed
         */
        subMenuOpened: {
          type: Boolean
        },


        /**
         * @exposed
         * @name mobileMenuOpened
         * @description defines if the mobile menu (drawer) should be opened or closed
         */
        mobileMenuOpened: {
          type: Boolean
        }
      },

      /**
       * @name attached
       * @description Event handler for scrolling behaviour
       * */
      attached: function () {
        this._scrollHandler();
      },
      /**
       * @name _scrollHandler
       * @description Handler for scrolling. Determines if the header should be compact or expanded
       * */
      _scrollHandler: function () {
        this.compactMenu = this._scrollTop > 50;
      },
      /**
       * @name _logoClicked
       * @description handle the clicks on the logo
       */
      _logoClicked: function (event) {
        // track this event
        Polymer.globalsManager.set('Dorel.events', {
          action: 'switch',
          component: 'logo',
          element: Polymer.dom(event).localTarget.parentNode, // needs to be parentNode!!!!!
          event: 'polymer_event',
          things: {
            'currentPage': document.URL,
            'targetPage': Polymer.dom(event).localTarget.parentNode.href // needs to be parentNode!!!!!
          }
        });
      },


      /**
       * @name _toggleMobileMenu
       * @description handler for toggling the mobile menu
       */
      _toggleMobileMenu: function (event) {

        // submenu (desktop) will always be false
        this.subMenuOpened = false;

        // actual mobileMenu toggler
        this.mobileMenuOpened = !this.mobileMenuOpened;

        // send event to tracking
        Polymer.globalsManager.set('Dorel.events', {
          action: this.mobileMenuOpened ? 'open' : 'close',
          component: 'hamburger',
          element: Polymer.dom(event).localTarget.parentNode,
          event: 'polymer_event',
          things: {
            'currentState': this.mobileMenuOpened ? 'close' : 'open',
            'toState': this.mobileMenuOpened ? 'open' : 'close'
          }
        });
      }
    });
  </script>
</dom-module>
