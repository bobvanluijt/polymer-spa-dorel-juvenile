<link rel="import" href="../../bower_components/polymer-bootstrap/polymer-bootstrap-min.html">
<link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html">

<dom-module id="dorel-section-big-video">
  <template>
    <style include="polymer-bootstrap-min">
      .section-big-video {
        height: 478px;
      }

      .section-big-video .video-wrap {
        text-align: center;
        position: relative;
        min-height: 478px;
      }
      .section-big-video .video-wrap iframe {
        margin: 0 auto;
        width: 100%;
        position: absolute;
        height: 100%;
        left: 0;
        top: 0;
      }
    </style>


    <!-- media queries -->
    <iron-media-query query="(max-width : 479px)" 
      query-matches="{{ mobileSmall }}"></iron-media-query>
    <iron-media-query query="(min-width : 480px) and (max-width : 767px)" 
      query-matches="{{ mobileMedium }}"></iron-media-query>
    <iron-media-query query="(min-width : 768px) and (max-width : 991px)"
      query-matches="{{ tablets }}"></iron-media-query>
    <iron-media-query query="(min-width : 992px) and (max-width : 1199px)" 
      query-matches="{{ desktopSmall }}"></iron-media-query>
    <iron-media-query query="(min-width : 1200px)" 
      query-matches="{{ desktopFull }}"></iron-media-query>
    
    <template
      is="dom-if"
      if="[[ videoWrapData ]]">
      <section class="section-big-video container-fluid"
        mobile-small$="{{ mobileSmall }}"
        mobile-medium$="{{ mobileMedium }}"
        tablets$="{{ tablets }}"
        desktop-small$="{{ desktopSmall }}"
        desktop-full$="{{ desktopFull }}">
        <div class="row">
          
          <template
            is="dom-if"
            if="[[ hasVideoId(videoWrapData.video_id) ]]">

            <template
              is="dom-if"
              if="[[ isYoutubeVideo(videoWrapData.video_type) ]]">
              <div class="video-wrap">
                <iframe src="https://www.youtube.com/embed/[[ videoWrapData.video_id ]]" 
                  frameborder="0" allowfullscreen
                  on-click="iframeClick"></iframe>
              </div>
            </template>

          </template>

        </div>
      </section>
    </template>

  </template>

  <script>
    Polymer({
      is: 'dorel-section-big-video',

      properties: {

        /** 
         * @attribute
         * @name videoWrapData
         * @description this is defined as an attribute on component level
         */
        videoWrapData: {
          type: Object,
          value: function() {
            return {};
          }
        },

        /**
         * @name playVideo
         * @description defines if the video currently playing
         */
        playVideo: {
          type: Boolean,
          value: false
        }

      },

      /** 
       * @name hasValue
       * @description check if a video id is defined in the videoWrapData
       */
      hasVideoId: function(videoId) {
        return (typeof videoId !== 'undefined' || videoId !== null || videoId !== '');
      },

      /**
       * @name isYoutube
       * @description checks if we are dealing with a video sourced by Youtube
       */
      isYoutubeVideo: function(videoType) {
        return (typeof videoType !== 'undefined' && videoType === 'youtube');
      },

      /**
       * @name iframeClick
       * @description handles clicks on the iframe
       */
      iframeClick: function(event) {
        this.playVideo = !this.playVideo;

        this._eventTracking(event);
      },

      /**
       * @name _eventTracking
       * @description this is for cta tracking only
       * more info http://bit.ly/2nb6I7G
       *
       * @todo tracking isn't working currently, because an iframe is used for videos
       */
      _eventTracking: function(event) {

        var globals = Polymer.globalsManager.get('Dorel');

        /** 
         * Tracking on click for cta
         */
        Polymer.globalsManager.set('Dorel.events', {
          action: (this.playVideo) ? 'play' : 'stop',
          component: 'big-video',
          element: Polymer.dom(event).localTarget,
          event: 'polymer_event'
        });
      }
    });
  </script>
</dom-module>
