<link rel="import" href="../atoms/dorel-inline-usps.html">
<link rel="import" href="../atoms/dorel-color-switcher.html">

<dom-module id="dorel-section-product-showcase">
  <template>
    <style include="iron-flex iron-flex-alignment">
      .section-product-showcase {
        width: 100%;
        float: left;
        padding: 1.5em var(--theme-gutter) 3em var(--theme-gutter);
        box-sizing: border-box;
      }

      .row {
        @apply(--theme-grid-row);
        @apply(--layout-flex);
        @apply(--layout-center-justified);
      }

      .showcase-gallery-view {
        @apply(--theme-grid-column);
        -ms-flex-preferred-size: calc(var(--theme-column-width) * 6);
        flex-basis: calc(var(--theme-column-width) * 6);
        max-width: calc(var(--theme-column-width) * 6);
      }

      .showcase-description {
        @apply(--theme-grid-column);
        -ms-flex-preferred-size: calc(var(--theme-column-width) * 5);
        flex-basis: calc(var(--theme-column-width) * 5);
        max-width: calc(var(--theme-column-width) * 5);
        margin-top: 3em;
      }

      .showcase-description {
        float: left;
      }

      .showcase-title {
        @apply(--theme-typography-8);
        color: var(--theme-brand-color-1);
        float: left;
        width: 100%;
      }

      .showcase-product-specs {
        list-style: none;
        @apply(--theme-typography-2);
        float: left;
        width: 100%;
        padding: 0;
      }

      .showcase-product-specs li {
        float: left;
        margin-right: 1.5em;
      }

      .actions dorel-cta {
        margin-right: 2em;
        float: left;
      }

      .product-description-text {
        float: left;
      }

      .section-product-showcase .showcase-gallery-view img {
        width: 500px;
        max-height: 500px;
        margin: auto;
        display: block;
      }

      /* Responsive Behaviour */
      [mobile] .showcase-gallery-view {
        -ms-flex-preferred-size: 100%;
        flex-basis: 100%;
        max-width: 100%;
        margin: auto;
      }

      [mobile] .showcase-product-specs {
        margin: auto;
        width: initial;
      }

      [mobile] .actions, [mobile] .color-mobile-container {
        -ms-flex-preferred-size: 100%;
        flex-basis: 100%;
        max-width: 100%;
      }

      [mobile] .showcase-gallery-view img {
        width: 300px;
      }

      [tablets] .showcase-gallery-view img {
        width: 400px;
        max-height: 500px;
      }

      [tablets] .showcase-description {
        -ms-flex-preferred-size: calc(var(--theme-column-width) * 6);
        flex-basis: calc(var(--theme-column-width) * 6);
        max-width: calc(var(--theme-column-width) * 6);
      }

    </style>


    <!-- media queries -->
    <iron-media-query query="(max-width : 767px)"
                      query-matches="{{ mobile }}"></iron-media-query>
    <iron-media-query query="(min-width : 768px) and (max-width : 991px)"
                      query-matches="{{ tablets }}"></iron-media-query>
    <!--
    <iron-media-query query="(min-width : 992px) and (max-width : 1199px)"
                      query-matches="{{ desktopSmall }}"></iron-media-query>
    <iron-media-query query="(min-width : 1200px)"
                      query-matches="{{ desktopFull }}"></iron-media-query> -->

    <template
      is="dom-if"
      if="[[ showcaseData ]]">
      <section class="section-product-showcase layout horizontal center center-justified wrap"
               mobile$="{{ mobile }}" tablets$="{{ tablets }}">

        <div class="row">
          <!-- Mobile Showcase -->
          <template is="dom-if" if="{{ mobile }}">
            <!-- Product Specs -->
            <ul class="showcase-product-specs">
              <template
                is="dom-if"
                if="[[ _hasValue(showcaseData.age_category) ]]">
                <li>
                  Age: [[ showcaseData.age_category ]]
                </li>
              </template>
              <template
                is="dom-if"
                if="[[ _hasValue(showcaseData.max_weight) ]]">
                <li>
                  Weight: max. [[ showcaseData.max_weight ]] kg.
                </li>
              </template>
              <template
                is="dom-if"
                if="[[ _hasValue(showcaseData.size) ]]">
                <li>
                  Size: [[ showcaseData.size ]] cm
                </li>
              </template>
            </ul>
            <div class="showcase-gallery-view">
              <img src="{{ currentImage.url }}" alt=""/>
            </div>
            <!--// Product Specs -->

            <!-- color switcher -->
            <template
              is="dom-if"
              if="[[ showcaseData.colors.length ]]">
              <div class="color-mobile-container  layout horizontal center center-justified wrap">
                <dorel-color-switcher
                  colors-data="[[ showcaseData.colors ]]"></dorel-color-switcher>
              </div>
            </template>
            <!--// color switcher -->

            <!-- Actions -->
            <div class="actions layout horizontal center center-justified wrap">
              <template
                is="dom-if"
                if="[[ _hasValue(showcaseData.accesoires_button) ]]">
                <dorel-cta
                  type="link"
                  link=""
                  size="small"
                  icon="dorel-icons:expand-more">
                  View Accessories
                </dorel-cta>
              </template>

              <template
                is="dom-if"
                if="[[ _hasValue(showcaseData.store_locator_button) ]]">
                <dorel-cta
                  type="primary"
                  link=""
                  size="small"
                  icon="dorel-icons:chevron-right">
                  Find a Store
                </dorel-cta>
              </template>
            </div>
            <!--// Actions -->
          </template>
          <!--// Mobile Showcase -->

          <!-- Desktop Showcase -->
          <template is="dom-if" if="{{ !mobile }}">
            <div class="showcase-gallery-view">
              <img src="{{ currentImage.url }}" alt=""/>
            </div>

            <!-- Title, usp's and extra info -->
            <div class="showcase-description">
              <template
                is="dom-if"
                if="[[ _hasValue(showcaseData.title) ]]">
                <h1 class="showcase-title">[[ showcaseData.title ]]</h1>
              </template>

              <ul class="showcase-product-specs">
                <template
                  is="dom-if"
                  if="[[ _hasValue(showcaseData.age_category) ]]">
                  <li>
                    Age: [[ showcaseData.age_category ]]
                  </li>
                </template>
                <template
                  is="dom-if"
                  if="[[ _hasValue(showcaseData.max_weight) ]]">
                  <li>
                    Weight: max. [[ showcaseData.max_weight ]] kg.
                  </li>
                </template>
                <template
                  is="dom-if"
                  if="[[ _hasValue(showcaseData.size) ]]">
                  <li>
                    Size: [[ showcaseData.size ]] cm
                  </li>
                </template>
              </ul>

              <template
                is="dom-if"
                if="[[ _hasValue(showcaseData.description) ]]">
                <div class="product-description-text">
                  <dorel-safe-html html="[[ showcaseData.description ]]"></dorel-safe-html>
                </div>
              </template>

              <!-- color switcher -->
              <template
                is="dom-if"
                if="[[ showcaseData.colors.length ]]">
                <dorel-color-switcher
                  colors-data="[[ showcaseData.colors ]]"></dorel-color-switcher>
              </template>
              <!--// color switcher -->

              <div class="actions">
                <template
                  is="dom-if"
                  if="[[ _hasValue(showcaseData.accesoires_button) ]]">
                  <dorel-cta
                    type="link"
                    link=""
                    size="small"
                    icon="dorel-icons:expand-more">
                    View Accessories
                  </dorel-cta>
                </template>

                <template
                  is="dom-if"
                  if="[[ _hasValue(showcaseData.store_locator_button) ]]">
                  <dorel-cta
                    type="primary"
                    link=""
                    size="small"
                    icon="dorel-icons:chevron-right">
                    Find a Store
                  </dorel-cta>
                </template>
              </div>
            </div>
          </template>
          <!--// Desktop Showcase -->
        </div>
      </section>
    </template>
  </template>

  <script>
    Polymer({
      is: 'dorel-section-product-showcase',

      properties: {

        /**
         * @attribute
         * @name showcaseData
         * @description the showcase data is defined as an attribute on this
         * component
         */
        showcaseData: {
          type: Object,
          observer: '_showcaseDataChanged'
        },

        /**
         * @name currentImage
         * @description This is the current selected image, because it's an
         * object we define the value with a function that returns an empty
         * object by default. It is updated when we get the Wordpress data
         */
        currentImage: {
          type: Object,
          value: function () {
            return {};
          }
        }
      },

      /**
       * @name ready
       * @description when the component is ready to use set the first
       * image from the Wordpress data as the currentImage
       */
      ready: function () {

        // reset current image to the first one in the array
        this.currentImage = this.showcaseData.gallery[0];

      },

      /**
       * @name ready
       * @description when the component is ready to use set the first
       * image from the Wordpress data as the currentImage
       */
      _showcaseDataChanged: function (newVal, oldVal) {
        if (typeof newVal === 'undefined') return;
        // reset current image to the first one in the array
        this.currentImage = this.showcaseData.gallery[0];
      },


      /**
       * @name clickThumbnail
       * @description this will handle of a click on the thumbnail and
       * will change the currentImage in the thumbnail clicked
       */
      clickThumbnail: function (event) {

        // set self to get the right context in forEach
        var self = this;
        var previousImage = this.currentImage;

        // extract the id and create currentImage var
        var imageId = event.target.id.split('-')[1];

        // find the right gallery image selected
        this.currentImage = this.showcaseData.gallery.find(function (item) {

          // set the current image if a match is found or null if not
          return item.id === Number(imageId);

        });

        // track the clickThumbnail
        this._eventTracking(event, previousImage);
      },

      /**
       * @name isCurrentImage
       * @description check if the thumbnail is the current image shown
       * @return String (current/empty)
       */
      isCurrentImage: function (item, currentItem) {

        // if not defined, empty or null jump out
        if (typeof item === 'undefined' || item === null || item === '') return;

        // returns current or empty 
        return (currentItem.ID === item.ID) ? 'current' : '';

      },

      /**
       * @name hasImage
       * @description check if the background image is defined
       * @return String (placeholder/img) placeholder or img url
       */
      _hasImage: function (img) {

        // check if img is defined or not
        return (typeof img === 'undefined' || img === '' || !img) ? '/assets/images/placeholders/showcase/placeholder.jpg' : img;
      },

      /**
       * @name hasValue
       * @description check if a value is set
       */
      _hasValue: function (val) {
        return (typeof val !== 'undefined' && val !== '');
      },

      /**
       * @name _eventTracking
       * @description this is for cta tracking only
       * more info http://bit.ly/2nb6I7G
       */
      _eventTracking: function (event, previousImage) {

        var globals = Polymer.globalsManager.get('Dorel');

        /**
         * Tracking on click for cta
         */
        Polymer.globalsManager.set('Dorel.events', {
          action: 'switchImage',
          component: 'showcase',
          element: Polymer.dom(event).localTarget,
          event: 'polymer_event',
          things: {
            'currentImage': previousImage,
            'targetImage': this.currentImage
          }
        });
      }
    });
  </script>
</dom-module>
