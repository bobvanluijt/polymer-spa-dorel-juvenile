<link rel="import" href="../molecules/dorel-expandable-content.html">

<dom-module id="dorel-section-product-showcase">
  <template>
    <style include="iron-flex iron-flex-alignment">
      :host {
        @apply(--max-width-host);
        perspective: 1200px;
      }

      #rotation-element {
        transform-style: preserve-3d;
      }

      .section-product-showcase {
        @apply(--max-width-container);
        padding: 1.5em var(--theme-gutter-mobile) 1.5em var(--theme-gutter-mobile);
        width: 100%;
        float: left;
        box-sizing: border-box;
      }

      .row {
        @apply(--theme-grid-row);
        @apply(--layout-flex);
        @apply(--layout-center-justified);
        @apply(--theme-grid-row-mobile-margins);
      }

      .showcase-gallery-view {
        @apply(--theme-grid-column);
        -ms-flex-preferred-size: 100%;
        flex-basis: 100%;
        max-width: 100%;
        margin: auto;
      }

      .showcase-description {
        @apply(--theme-grid-column);
        -ms-flex-preferred-size: calc(var(--theme-column-width) * 6);
        flex-basis: calc(var(--theme-column-width) * 6);
        max-width: calc(var(--theme-column-width) * 6);
        margin-top: 1.5em;
      }

      .showcase-description {
        float: left;
      }

      .showcase-title {
        @apply(--theme-typography-8);
        float: left;
        width: 100%;
      }

      .showcase-product-specs {
        @apply(--theme-typography-1);
        margin-top: 0;
        list-style: none;
        float: left;
        padding: 0;
        width: initial;
      }

      .showcase-product-specs li {
        float: left;
        margin-right: 1em;
      }

      .actions, .color-mobile-container {
        -ms-flex-preferred-size: 100%;
        flex-basis: 100%;
        max-width: 100%;
      }

      .actions dorel-cta {
        margin: 0 .5em 0 0;
      }

      .actions dorel-cta:first-child {
        margin-left: 0;
      }

      .actions dorel-cta:last-child {
        margin-right: 0;
      }

      .showcase-gallery-view .image {
        width: 100%;
        height: 24em;
        margin: 1.5em auto 0 auto;
      }

      .award-section {
        width: 100%;
        display: flex;
      }

      .award-section-mobile {
        display: flex;
        justify-content: space-around;
      }

      .award {
        margin-top: 1.5rem;
        margin-right: 0.75rem;
      }

      /* Responsive Behaviour */
      [tablet-medium-up] .showcase-gallery-view {
        -ms-flex-preferred-size: calc(var(--theme-column-width) * 6);
        flex-basis: calc(var(--theme-column-width) * 6);
        max-width: calc(var(--theme-column-width) * 6);
      }

      /* TODO: not sure if we actually need this */
      [tablet-medium-up] .actions, [tablet-medium-up] .color-mobile-container {

      }

      [tablet-medium-up] .showcase-gallery-view .image {
        margin: auto;
        display: block;
        width: 31em;
        height: 34.5em;
      }

      [tablet-medium] .showcase-gallery-view .image {
        width: 23.25em;
        height: 26.25em;
        margin-top: 1.5em;
      }

      [tablet-medium-up] .showcase-description {
        -ms-flex-preferred-size: calc(var(--theme-column-width) * 6);
        flex-basis: calc(var(--theme-column-width) * 6);
        max-width: calc(var(--theme-column-width) * 6);
      }

      .section-product-showcase[tablet-medium-up] {
        padding: 1.5em var(--theme-gutter) 3em var(--theme-gutter);
      }

      [tablet-medium-up] .actions dorel-cta {
        margin: 0 1em 0 0;
        float: left;
      }

      [tablet-medium-up] .showcase-product-specs {
        @apply(--theme-typography-2);
        width: 100%;
        margin: 1.5em 0 0 0;
      }

      [tablet-medium-up] .showcase-product-specs li {
        margin-right: 1.5em;
      }

      [tablet-medium-up] .row {
        @apply(--theme-grid-row-margins);
      }

    </style>

    <dorel-media-query breakpoints="{{ breakpoints }}"></dorel-media-query>

    <template
      is="dom-if"
      if="[[ showcaseData ]]">
      <section class="section-product-showcase layout horizontal center center-justified wrap"
               tablet-medium-up$="{{ breakpoints.tabletMediumUp }}"
               tablet-medium$="{{ breakpoints.tabletMedium }}">

        <div class="row">
          <!-- Mobile Showcase -->
          <template is="dom-if" if="{{ !breakpoints.tabletMediumUp }}">
            <!-- Product Specs -->
            <ul class="showcase-product-specs">
              <template
                is="dom-if"
                if="[[ _hasValue(showcaseData.age.value) ]]">
                <li>
                  <b>Age:</b><br> [[ showcaseData.age.value ]]
                </li>
              </template>
              <template
                is="dom-if"
                if="[[ _hasValue(showcaseData.max_weight.value) ]]">
                <li>
                  <b>Weight:</b><br> [[ showcaseData.max_weight.value ]]
                </li>
              </template>
              <template
                is="dom-if"
                if="[[ _hasValue(showcaseData.size) ]]">
                <li>
                  <b>Size:</b><br> [[ showcaseData.size.value ]] cm
                </li>
              </template>
            </ul>
            <!--// Product Specs -->

            <div class="showcase-gallery-view">
              <iron-image class="image"
                          sizing="contain"
                          fade="true"
                          preload
                          src$="[[ currentImage ]]"></iron-image>
            </div>

            <!-- color switcher -->
            <template
              is="dom-if"
              if="[[ showcaseData.child_products.length ]]">
              <div class="color-mobile-container  layout horizontal center center-justified wrap">
                <dorel-color-switcher
                  current-image="{{ currentImage }}"
                  colors-data="[[ showcaseData.child_products ]]"
                  gtm-action="switch-color"
                  gtm-parent="[[ gtmParent ]]"
                  gtm-parent-index="[[ gtmParentIndex ]]"
                  gtm-child="dorel-color-switcher"
                  gtm-child-index="0"></dorel-color-switcher>
              </div>
            </template>
            <!--// color switcher -->

            <!-- Actions -->
            <div class="actions layout horizontal center center-justified wrap">
              <template
                is="dom-if"
                if="[[ _hasValue(showcaseData.accesoires_button) ]]">
                <dorel-cta
                  type="link"
                  title="View Accessories"
                  on-click="_viewAccessories"
                  size="medium"
                  icon="dorel-icons:expand-more"
                  gtm-action="scroll-to-accessories"
                  gtm-parent="[[ gtmParent ]]"
                  gtm-parent-index="[[ gtmParentIndex ]]"
                  gtm-cta-index="0">
                  View Accessories
                </dorel-cta>
              </template>

              <template
                is="dom-if"
                if="[[ _hasValue(showcaseData.store_locator_button, storeLocatorPage.link) ]]">
                <dorel-cta
                  type="primary"
                  title="Find a Store"
                  link="[[ storeLocatorPage.link ]]"
                  size="medium"
                  icon="dorel-icons:chevron-right"
                  gtm-action="click"
                  gtm-parent="[[ gtmParent ]]"
                  gtm-parent-index="[[ gtmParentIndex ]]"
                  gtm-cta-index="1">
                  Find a Store
                </dorel-cta>
              </template>
            </div>

            <div class="award-section-mobile">
              <template is="dom-repeat" items="[[ showcaseData.award_list ]]" as="awardImageUrl">
                <div class="award">
                  <iron-image class="award__image"
                              fade="true"
                              style="height: 3rem; width: 5rem;"
                              sizing="contain"
                              preload
                              src$="[[ awardImageUrl ]]"></iron-image>
                </div>
              </template>
            </div>
            <!--// Actions -->
          </template>
          <!--// Mobile Showcase -->

          <!-- Desktop Showcase -->
          <template is="dom-if" if="{{ breakpoints.tabletMediumUp }}">
            <div class="showcase-gallery-view" on-track="handleTrack">
              <iron-image class="image"
                          id="rotation-element"
                          sizing="cover"
                          fade="true"
                          preload
                          src$="[[ currentImage ]]"></iron-image>
            </div>
            <!-- Title, usp's and extra info -->
            <div class="showcase-description">
              <template
                is="dom-if"
                if="[[ _hasValue(showcaseData.name.value) ]]">
                <p class="showcase-title">[[ showcaseData.name.value ]]</p>
              </template>

              <ul class="showcase-product-specs">
                <template
                  is="dom-if"
                  if="[[ _hasValue(showcaseData.age.value) ]]">
                  <li>
                    <b>Age:</b><br> [[ showcaseData.age.value ]]
                  </li>
                </template>
                <template
                  is="dom-if"
                  if="[[ _hasValue(showcaseData.max_weight.value) ]]">
                  <li>
                    <b>Weight:</b><br> [[ showcaseData.max_weight.value ]]
                  </li>
                </template>
                <template
                  is="dom-if"
                  if="[[ _hasValue(showcaseData.size) ]]">
                  <li>
                    <b>Size:</b><br> [[ showcaseData.size.value ]] cm
                  </li>
                </template>
              </ul>

              <!-- expandable text description -->
              <template
                is="dom-if"
                if="[[ _hasValue(showcaseData.description.value) ]]">
                <dorel-expandable-content content="[[ showcaseData.description.value ]]"></dorel-expandable-content>
              </template>
              <!-- expandable text description  -->

              <!-- color switcher -->
              <template
                is="dom-if"
                if="[[ showcaseData.child_products.length ]]">
                <dorel-color-switcher
                  current-image="{{ currentImage }}"
                  colors-data="[[ showcaseData.child_products ]]"
                  gtm-action="switch-color"
                  gtm-parent="[[ gtmParent ]]"
                  gtm-parent-index="[[ gtmParentIndex ]]"
                  gtm-child="dorel-color-switcher"
                  gtm-child-index="0"></dorel-color-switcher>
              </template>
              <!--// color switcher -->

              <div class="actions">

                <template
                  is="dom-if"
                  if="[[ _hasStoreLocator(storeLocatorPage.link) ]]">
                  <dorel-cta
                    title="Find a Store"
                    type="primary"
                    link="[[ storeLocatorPage.link ]]"
                    size="medium"
                    icon="dorel-icons:chevron-right"
                    gtm-action="click"
                    gtm-parent="[[ gtmParent ]]"
                    gtm-parent-index="[[ gtmParentIndex ]]"
                    gtm-cta-index="1">
                    Find a Store
                  </dorel-cta>
                </template>

                <template
                  is="dom-if"
                  if="[[ _hasAccessories(showcaseData) ]]">
                  <dorel-cta
                    type="link"
                    title="View Accessories"
                    link=""
                    size="medium"
                    on-click="_viewAccessories"
                    icon="dorel-icons:expand-more"
                    gtm-action="scroll-to-accessories"
                    gtm-parent="[[ gtmParent ]]"
                    gtm-parent-index="[[ gtmParentIndex ]]"
                    gtm-cta-index="0">
                    View Accessories
                  </dorel-cta>
                </template>
              </div>

              <div class="award-section">
                <template is="dom-repeat" items="[[ showcaseData.award_list ]]" as="awardImageUrl">
                  <div class="award">
                    <iron-image class="award__image"
                                fade="true"
                                style="height: 5rem; width: 8rem;"
                                sizing="contain"
                                preload
                                src$="[[ awardImageUrl ]]"></iron-image>
                  </div>
                </template>
              </div>

            </div>
          </template>
          <!--// Desktop Showcase -->
        </div>
      </section>
    </template>
  </template>

  <script>
    Polymer({
      is: 'dorel-section-product-showcase',

      properties: {

        appCache: {
          type: Object,
          value: function(){
            return {};
          }
        },

        /**
         * @attribute
         * @name accessoryScrollHandler
         * @description exposes the accessoryScrollHandler to other components
         */
        accessoryScrollHandler: {
          type: Boolean,
          notify: true
        },

        /**
         * @attribute
         * @name showcaseData
         * @description the showcase data is defined as an attribute on this
         * component
         */
        showcaseData: {
          type: Object
        },


        /**
         * @name currentImage
         * @description This is the current selected image, the image is
         * defined by the color switcher
         */
        currentImage: {
          type: String
        },
      },

      observers: [
        '_hasRelatedProducts(showcaseData)'
      ],

      ready: function() {
         //TODO: TO BE REMOVED AFTER IMPLEMENTING STORE PRODUCT FINDER
         var pages = this.get('appCache.collect.pages');

         var storeLocatorPage = pages.find(function(page) {
           return page.template === 'store-locator';
         });
         this.set('storeLocatorPage', storeLocatorPage);
         if(storeLocatorPage) {
           this.set('storeLocatorPage.store_locator_button', true);
         }
      },

      /**
       * @name _hasAccessories
       * @description check if a the accessories are defined
       * and if the toggle is enabled in WP
       *
       * @return Boolean
       */
      _hasAccessories: function (showcaseData) {
        return Boolean(showcaseData && showcaseData.related_products && showcaseData.related_products.length);
      },

      /**
       * @name _hasStoreLocator
       * @description check if a store-locator page is defined and
       * if the toggle is enabled in WP
       *
       * @return Boolean
       */
      _hasStoreLocator: function (page) {
        page = (typeof page !== 'undefined' && page !== '');
        return (page);
      },

      /**
       * @name _hasValue
       * @description check if a value is set
       */
      _hasValue: function (val) {
        return (typeof val !== 'undefined' && val !== '' && val);
      },

      _hasRelatedProducts: function(showcaseData) {
        if(!showcaseData || !Object.keys(showcaseData).length) {
          return;
        }
        if(showcaseData.relatedProducts && showcaseData.relatedProducts.length) {
          this.showcaseData.accesoires_button = true;
        } else {
          this.showcaseData.accesoires_button = false;
        }
      },

      /**
       * @name _viewAccessories
       * @description scroll to the accesory section
       * */
      _viewAccessories: function (event) {
        this.accessoryScrollHandler = !this.accessoryScrollHandler;
      }
    });
  </script>
</dom-module>
