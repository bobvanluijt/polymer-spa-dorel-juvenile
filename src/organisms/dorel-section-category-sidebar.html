<dom-module id="dorel-section-category-sidebar">
  <template>
    <style>
      :host {
        opacity: 0;  /* make things invisible upon start */
        -webkit-animation: fadeIn ease 1;  /* call our keyframe named fadeIn, use animattion ease-in and repeat it only 1 time */
        -moz-animation: fadeIn ease 1;
        animation: fadeIn ease 1;
        -webkit-animation-duration: 1s;
        -moz-animation-duration: .1s;
        animation-duration: 1s;
        -webkit-animation-fill-mode: forwards;  /* this makes sure that after animation is done we remain at the last keyframe value (opacity: 1)*/
        -moz-animation-fill-mode: forwards;
        animation-fill-mode: forwards;
      }

      @-webkit-keyframes fadeIn { from { opacity: 0; opacity: 1\9; /* IE9 only */ } to { opacity: 1; } }
      @-moz-keyframes fadeIn { from { opacity: 0; opacity: 1\9; /* IE9 only */ } to { opacity: 1; } }
      @keyframes fadeIn { from { opacity: 0; opacity: 1\9; /* IE9 only */ } to { opacity: 1; } }

      .title {
        @apply(--theme-typography-4);
        float: left;
        width: 100%;
      }
    </style>

    <template
      is="dom-if"
      if="[[ _hasSidebar(categorySidebarData.sidebar) ]]">
      <aside class="category-sidebar">

        <template
          is="dom-repeat"
          items="[[ contentWrappers ]]"
          as="contentWrap">

          <div class="content-wrapper">
            <div class="content">
              <template is="dom-if" if="[[ _hasValue(contentWrap.title) ]]">
                <template is="dom-if" if="{{ _isMainHeader(index) }}">
                  <h1 class="title">[[ contentWrap.title ]]</h1>
                </template>

                <template is="dom-if" if="{{ !_isMainHeader(index) }}">
                  <h2 class="title">[[ contentWrap.title ]]</h2>
                </template>
              </template>

              <template is="dom-if" if="[[ _hasValue(contentWrap.title) ]]">
                <div class="text">
                  <dorel-safe-html html="[[ contentWrap.text ]]"></dorel-safe-html>
                </div>
              </template>
            </div>
          </div>

        </template>
      </aside>
    </template>
  </template>
  <script>
    Polymer({
      is: 'dorel-section-category-sidebar',

      properties: {

        /**
         * @attribute
         * @name categorySidebarData
         * @description all data defined by ACF/Wordpress to build this component
         */
        categorySidebarData: {
          type: Object,
          value: function () {
            return {};
          }
        }

      },

      behaviors: [DorelHasValueBehavior],

      ready: function () {
        this.contentWrappers = this.categorySidebarData.sidebar[0].content_wrappers;
      },

      /**
       * @name _hasSidebar
       * @description checks to see if the sidebar and the content_wrap has items
       *
       * @returns Boolean
       */
      _hasSidebar: function (sidebar) {
        if(!sidebar){
          return false;
        }
        return (typeof sidebar !== 'undefined' || sidebar.length && sidebar[0].content_wrap.length);
      },

      /**
       * @name _isMainHeader
       * @description check if this is the first content wrapper which should be an h1
       *
       * @returns Boolean
       */
      _isMainHeader: function (index) {
        return (typeof index !== 'undefined' && index < 1);
      }
    });
  </script>
</dom-module>
