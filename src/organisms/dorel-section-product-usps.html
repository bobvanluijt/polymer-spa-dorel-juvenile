<link rel="import" href="../utils/dorel-magento-collect-custom-data.html">

<dom-module id="dorel-section-product-usps">
  <template>
    <style>
      :host {
        @apply(--max-width-host);
      }

      .section-product-usps {
        @apply(--max-width-container);
        width: 100%;
        float: left;
        box-sizing: border-box;
        padding: 1.5em var(--theme-gutter-mobile);
      }

      .title {
        @apply(--theme-typography-5);
        color: var(--theme-brand-color-1);
        width: 100%;
        text-align: center;
      }

      .usp-title {
        @apply(--theme-typography-3);
        float: left;
        width: 100%;
      }

      .usp-description {
        float: left;
        margin: .75em 0;
      }

      .row {
        @apply(--theme-grid-row);
        @apply(--layout-flex);
        @apply(--layout-center-justified);
        @apply(--theme-grid-row-mobile-margins);
      }

      .usp {
        @apply(--theme-grid-column);
        @apply(--theme-grid-column-mobile);
        -ms-flex-preferred-size: 100%;
        flex-basis: 100%;
        max-width: 100%;
        padding: 0;
        margin-top: 1.5em;
      }

      .usp-image {
        width: 100%;
        float: left;
        height: 12em;
      }

      .usp-content {
      }

      /* Responsive behaviour */
      .section-product-usps[tablet-medium-up] {
        padding: 1.5em var(--theme-gutter) 3em var(--theme-gutter);
      }

      [tablet-medium-up] .usp {
        padding: 0 .75em;
        -ms-flex-preferred-size: calc(var(--theme-column-width) * 4);
        flex-basis: calc(var(--theme-column-width) * 4);
        max-width: calc(var(--theme-column-width) * 4);
      }

      [tablet-medium] .usp {
        -ms-flex-preferred-size: calc(var(--theme-column-width) * 6);
        flex-basis: calc(var(--theme-column-width) * 6);
        max-width: calc(var(--theme-column-width) * 6);
      }

      [tablet-medium-up] .row {
        @apply(--theme-grid-row-margins);
      }

      [tablet-medium-up] .title {
        @apply(--theme-typography-7);
      }

    </style>

    <dorel-magento-collect-custom-data
      product-id="[[ productId ]]"
      data="{{ uspsData }}"
      app-cache="[[ appCache ]]"
      type="usps"></dorel-magento-collect-custom-data>

    <template is="dom-if"
              if="[[ uspsData.usps.length ]]">

      <dorel-media-query breakpoints="{{ breakpoints }}"></dorel-media-query>

      <section class="section-product-usps layout horizontal center center-justified wrap"
               tablet-medium-up$="{{ breakpoints.tabletMediumUp }}"
               tablet-medium$="{{ breakpoints.tabletMedium }}">

        <template
          is="dom-if"
          if="[[ _hasValue(uspsData.title) ]]">
          <h4 class="title">[[ uspsData.title ]]</h4>
        </template>

        <template
          is="dom-if"
          if="[[ uspsData.usps.length ]]">
          <div class="row">

            <template
              is="dom-repeat"
              items="[[ uspsData.usps ]]"
              as="usp">

              <div class="usp">
                <div class="usp-wrapper">

                  <template
                    is="dom-if"
                    if="[[ _hasValue(usp.image) ]]">
                    <iron-image class="usp-image"
                                sizing="cover"
                                fade="true"
                                preload
                                src$="[[ usp.image ]]">
                    </iron-image>
                  </template>

                  <div class="usp-content">

                    <template
                      is="dom-if"
                      if="[[ _hasValue(usp.title) ]]">
                      <h3 class="usp-title">[[ usp.title ]]</h3>
                    </template>

                    <template
                      is="dom-if"
                      if="[[ _hasValue(usp.description) ]]">
                      <div class="usp-description">
                        <dorel-safe-html html="[[ usp.description ]]"></dorel-safe-html>
                      </div>
                    </template>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </template>
      </section>
    </template>
  </template>
  <script>
    Polymer({
      is: 'dorel-section-product-usps',
      properties: {

        productId: {
          type: Number
        },

        /**
         * @attribute
         * @name uspsData
         * @description coming from the page-builder this data object is filled
         * with ACF/Wordpress data about the component
         */
        uspsData: {
          type: Object
        },

        /**
         * @attribute
         * @name appCache
         * @description the temporary cache of the application,
         * contains data that used to be contained by the globalsManager
         */
        appCache: {
          type: Object
        }
      },

      behaviors: [ConditionalBehaviors]
    });
  </script>
</dom-module>
