<dom-module id="dorel-section-product-accessories">
  <template>
    <style include="iron-flex iron-flex-alignment">
      .section-product-accessories {
        padding: var(--theme-component-space-inner);
        @apply(--layout-flex);
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
        @apply(--layout-wrap);
      }

      .column-headline {
        @apply(--theme-heading);
        font-size: var(--theme-size-display1);
        margin: 0;
        text-align: center;
      }

      .accessory-title {
        @apply(--theme-heading);
        text-align: center;
        margin: var(--theme-component-space-micro) 0 0 0;
      }

      .accessory-wrap {
        @apply(--layout-flex);
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
        @apply(--layout-wrap);

      }

      .accessory {
        padding: var(--theme-component-space-inner);
        text-align: center;
      }

      .accessory a {
        text-decoration: none;
        color: var(--theme-color-link-primary);
        transition: .3s ease color;
      }

      .accessory a:hover, .accessory a:focus {
        color: var(--theme-color-text-link-active);
      }

      .accessories {
        padding: var(--theme-component-space-inner);
      }

    </style>

    <section class="section-product-accessories">
      
      <template
        is="dom-if"
        if="[[ _hasValue(accessoriesData.title) ]]">
        <h1 class="title">[[ accessoriesData.title ]]</h1>
      </template>

      <template
        is="dom-if"
        if="[[ accessoriesData.accessories.length ]]">
        <div class="row">
        
          <template
            is="dom-repeat"
            items="[[ accessoriesData.accessories ]]"
            as="accessory">

            <div class="accessory">
              <div class="accessory-wrapper">

                <template
                  is="dom-if"
                  if="{{ accessory.included }}">
                  <span class="accessory-included-batch"></span>
                </template>

                <template
                  is="dom-if"
                  if="{{ _hasValue(accessory.image) }}">
                  <iron-image class="accessory-image"
                              sizing="cover"
                              fade="true"
                              preload
                              placeholder="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAARUlEQVQYVx3LsQ2AQAwEwXPP9EIt9EADBOcMkRG8Lfk+MnrCHWltO709BIbgKdh+Pc0oeE5wFOy43/5jYQjGqOYQmGsrfE+bLy6etpfQAAAAAElFTkSuQmCC"
                              src$="[[ accessory.image ]]"></iron-image>
                </template>

                <template
                  is="dom-if"
                  if="{{ _hasValue(accessory.title) }}">
                  <h4 class="accessory-title">[[ accessory.title ]]</h4>
                </template>

                <template
                  is="dom-if"
                  if="{{ _hasValue(accessory.description) }}">
                  <div class="accessory-description">
                    <dorel-safe-html html="[[ accessory.description ]]"></dorel-safe-html>
                  </div>
                </template>

                <template
                  is="dom-if"
                  if="{{ _hasValue(accessory.permalink) }}">
                  <a href$="[[ accessory.permalink ]]"
                    on-click="clickDetails">
                    See details <iron-icon class="chevron" icon="dorel-icons:chevron-right"></iron-icon>
                  </a>
                </template>

              </div>
            </div>

          </template>

        </div>
      </template>

    </section>
  </template>

  <script>

    Polymer({
      is: 'dorel-section-product-accessories',

      properties: {

        /**
         * @attribute
         * @name accessoriesData
         * @description data retrieved from ACF/Wordpress to build up this page
         */
        accessoriesData: {
          type: Object,
          value: function() {
            return {};
          }
        }

      },
      
      /**
       * @name clickDetails
       * @description handle of the click on the details links
       */
      clickDetails: function(event) {

        // track the event
        this._eventTracking(event);

      },


      /**
       * @name _hasValue
       * @description checks to see if a value is set
       *
       * @returns Boolean
       */
      _hasValue: function (val) {
        return (typeof val !== 'undefined' || val !== '');
      },

      /**
       * @name _eventTracking
       * @description this is for cta tracking only 
       * more info http://bit.ly/2nb6I7G
       */
      _eventTracking: function(event) {

        var globals = Polymer.globalsManager.get('Dorel');

        /** 
         * Tracking on click for cta
         */
        Polymer.globalsManager.set('Dorel.events', {
          action: 'click',
          component: 'product-accessories',
          element: Polymer.dom(event).localTarget,
          event: 'polymer_event',
          things: {
            'currentPage': document.URL,
            'targetPage': Polymer.dom(event).localTarget.href
          }
        });
      }
    });

  </script>

</dom-module>
