<dom-module id="dorel-section-product-accessories">
  <template>
    <style include="iron-flex iron-flex-alignment">

      :host {
        float: left;
        width: 100%;
      }

      .section-product-accessories {
        width: 100%;
        float: left;
        padding: 4.5em var(--theme-gutter) 7.5em var(--theme-gutter);
        box-sizing: border-box;
        background-color: var(--theme-color-monochrome-2);
      }

      .title {
        @apply(--theme-typography-7);
        color: var(--theme-brand-color-1);
        width: 100%;
        text-align: center;
      }

      .accessory-title {
        @apply(--theme-typography-4);
        float: left;
        width: 100%;
        margin-top: 0;
      }

      .accessory-description {
        float: left;
      }

      dorel-cta {
        float: left;
        clear: both;
      }

      dorel-cta a {
        margin-top: 0;
      }

      .row {
        float: left;
        width: 100%;
      }

      .accessory {
        @apply(--theme-grid-column);
        -ms-flex-preferred-size: calc(var(--theme-column-width) * 4);
        flex-basis: calc(var(--theme-column-width) * 4);
        max-width: calc(var(--theme-column-width) * 4);
        padding: 0 .75em;
        margin-top: 3em;
        float: left;
      }

      .accessory-wrapper {
        padding: 0 1em;
        float: left;
        width: 100%;
        position: relative;
      }

      .accessory-included-badge {
        @apply(--theme-typography-1);
        background-color: var(--theme-brand-complementary-color-3);
        color: var(--theme-color-white);
        margin-top: 0;
        position: absolute;
        top: .5em;
        left: 1.5em;
        z-index: 1;
        border-radius: 0.875em;
        padding: 0 .75em;

      }

      .accessory-image {
        float: left;
        width: 10.5em;
        height: 10.5em;
        border-radius: .5em;
      }

      .accessory-content {
        width: calc(100% - 10.5em);
        padding: 0 0 0 1.5em;
        box-sizing: border-box;
        float: left;
      }

      /* Responsive Behaviour */
      .section-product-accessories[mobile-small], .section-product-accessories[mobile-medium] {
        padding: 1.5em var(--theme-gutter-mobile) 3em var(--theme-gutter-mobile);
      }

      [mobile-small] .accessory, [mobile-medium] .accessory {
        @apply(--theme-grid-column-mobile);
      }

      [mobile-small] .row {
        margin-right: -0.25em;
        margin-left: -0.25em;
      }

      [mobile-medium] .row {
        margin-right: -0.5em;
        margin-left: -0.5em;
      }

      [tablets] .accessory, [desktop-small] .accessory {
        -ms-flex-preferred-size: calc(var(--theme-column-width) * 6);
        flex-basis: calc(var(--theme-column-width) * 6);
        max-width: calc(var(--theme-column-width) * 6);
      }

      [mobile-small] .accessory, [mobile-medium] .accessory {
        -ms-flex-preferred-size: 100%;
        flex-basis: 100%;
        max-width: 100%;
      }

      [mobile-small] .accessory-image, [mobile-medium] .accessory-image {
        width: 6em;
        height: 6em;
      }

      [mobile-small] .accessory-content, [mobile-medium] .accessory-content {
        width: calc(100% - 6em);
        padding: 0 0 0 1.5em;
        box-sizing: border-box;
        float: left;
        margin-top: -1.5em;
      }


    </style>

    <!-- media queries -->
    <iron-media-query query="(max-width : 479px)"
                      query-matches="{{ mobileSmall }}"></iron-media-query>
    <iron-media-query query="(min-width : 480px) and (max-width : 820px)"
                      query-matches="{{ mobileMedium }}"></iron-media-query>
    <iron-media-query query="(min-width : 821px) and (max-width : 991px)"
                      query-matches="{{ tablets }}"></iron-media-query>
    <iron-media-query query="(min-width : 992px) and (max-width : 1199px)"
                      query-matches="{{ desktopSmall }}"></iron-media-query>

    <section class="section-product-accessories layout horizontal center center-justified wrap"
             mobile-small$="{{ mobileSmall }}"
             mobile-medium$="{{ mobileMedium }}"
             tablets$="{{ tablets }}"
             desktop-small$="{{ desktopSmall }}">
      <template
        is="dom-if"
        if="[[ _hasValue(accessoriesData.title) ]]">
        <h1 class="title">[[ accessoriesData.title ]]</h1>
      </template>

      <template
        is="dom-if"
        if="[[ accessoriesData.accessories.length ]]">
        <div class="row">

          <template
            is="dom-repeat"
            items="[[ accessoriesData.accessories ]]"
            as="accessory">

            <div class="accessory">
              <div class="accessory-wrapper">

                <template
                  is="dom-if"
                  if="{{ accessory.included }}">
                  <span class="accessory-included-badge">
                    Included
                  </span>
                </template>

                <template
                  is="dom-if"
                  if="{{ _hasValue(accessory.image) }}">
                  <iron-image class="accessory-image"
                              sizing="cover"
                              fade="true"
                              preload
                              placeholder="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAARUlEQVQYVx3LsQ2AQAwEwXPP9EIt9EADBOcMkRG8Lfk+MnrCHWltO709BIbgKdh+Pc0oeE5wFOy43/5jYQjGqOYQmGsrfE+bLy6etpfQAAAAAElFTkSuQmCC"
                              src$="[[ accessory.image ]]"></iron-image>
                </template>

                <div class="accessory-content">
                  <template
                    is="dom-if"
                    if="{{ _hasValue(accessory.title) }}">
                    <h4 class="accessory-title">[[ accessory.title ]]</h4>
                  </template>

                  <template
                    is="dom-if"
                    if="{{ _hasValue(accessory.description) }}">
                    <div class="accessory-description">
                      <dorel-safe-html html="[[ accessory.description ]]"></dorel-safe-html>
                    </div>
                  </template>

                  <template
                    is="dom-if"
                    if="{{ _hasValue(accessory.permalink) }}">
                    <dorel-cta
                      type="link"
                      link="[[ accessory.permalink ]]"
                      size="small"
                      icon="dorel-icons:play-circle-outline">
                      View Accessories
                    </dorel-cta>
                  </template>
                </div>
              </div>
            </div>
          </template>

        </div>
      </template>

    </section>
  </template>

  <script>

    Polymer({
      is: 'dorel-section-product-accessories',

      properties: {
        accessoryScrollHandler: {
          type: Boolean,
          notify: true,
          observer: '_scrollHandler'
        },
        /**
         * @attribute
         * @name accessoriesData
         * @description data retrieved from ACF/Wordpress to build up this page
         */
        accessoriesData: {
          type: Object,
          value: function () {
            return {};
          }
        }

      },

      /**
       * @name clickDetails
       * @description handle of the click on the details links
       */
      clickDetails: function (event) {

        // track the event
        this._eventTracking(event);

      },


      /**
       * @name _hasValue
       * @description checks to see if a value is set
       *
       * @returns Boolean
       */
      _hasValue: function (val) {
        return (typeof val !== 'undefined' || val !== '');
      },

      /**
       * @name _resizeHandler
       * @description sets the scroll offset position of this section
       *
       */
      _scrollHandler: function (event) {
        this.scrollIntoView({block: "end", behavior: "smooth"})
      },

      /**
       * @name _eventTracking
       * @description this is for cta tracking only
       * more info http://bit.ly/2nb6I7G
       */
      _eventTracking: function (event) {

        var globals = Polymer.globalsManager.get('Dorel');

        /**
         * Tracking on click for cta
         */
        Polymer.globalsManager.set('Dorel.events', {
          action: 'click',
          component: 'product-accessories',
          element: Polymer.dom(event).localTarget,
          event: 'polymer_event',
          things: {
            'currentPage': document.URL,
            'targetPage': Polymer.dom(event).localTarget.href
          }
        });
      }
    });

  </script>

</dom-module>
