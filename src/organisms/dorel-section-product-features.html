<dom-module id="dorel-section-product-features">
  <template>
    <style>
      .section-product-features {
        width: 100%;
        float: left;
        padding: 1.5em var(--theme-gutter) 4.5em var(--theme-gutter);
        box-sizing: border-box;
      }

      .title {
        @apply(--theme-typography-7);
        color: var(--theme-brand-color-1);
        width: 100%;
        text-align: center;
      }

      .feature-title {
        @apply(--theme-typography-4);
        float: left;
        width: 100%;
      }

      .feature-description {
        float: left;
      }

      .row {
        @apply(--theme-grid-row);
        @apply(--layout-flex);
        @apply(--layout-center-justified);
      }

      .feature {
        @apply(--theme-grid-column);
        -ms-flex-preferred-size: calc(var(--theme-column-width) * 3);
        flex-basis: calc(var(--theme-column-width) * 3);
        max-width: calc(var(--theme-column-width) * 3);
        padding: 0 .75em;
        margin-top: 3em;
      }

      .feature-wrapper {
        padding: 0 1em;
      }

      .feature-image {
        width: 15em;
        height: 15em;
        margin: auto;
        float: none;
        display: block;
      }

      /* Responsive Behaviour */

      [mobile-small], [mobile-medium] {
        padding: 1.5em var(--theme-gutter-mobile) 3em var(--theme-gutter-mobile);
      }

      [tablets] .feature {
        -ms-flex-preferred-size: calc(var(--theme-column-width) * 6);
        flex-basis: calc(var(--theme-column-width) * 6);
        max-width: calc(var(--theme-column-width) * 6);
      }

      [mobile-small] .feature, [mobile-medium] .feature {
        @apply(--theme-grid-column-mobile);
        -ms-flex-preferred-size: 100%;
        flex-basis: 100%;
        max-width: 100%;
      }

      [mobile-small] .row {
        margin-right: -0.25em;
        margin-left: -0.25em;
      }

      [mobile-medium] .row {
        margin-right: -0.5em;
        margin-left: -0.5em;
      }

      [mobile-small] .feature-image, [mobile-medium] .feature-image {
        width: 6em;
        height: 6em;
        float: left;
      }

      [mobile-small] .feature-content, [mobile-medium] .feature-content {
        width: calc(100% - 6em);
        padding: 0 0 0 1.5em;
        box-sizing: border-box;
        float: left;
      }

      [mobile-small] .feature-title, [mobile-medium] .feature-title {
        margin-top: 0;
      }


    </style>

    <!-- media queries -->
    <iron-media-query query="(max-width : 479px)"
                      query-matches="{{ mobileSmall }}"></iron-media-query>
    <iron-media-query query="(min-width : 480px) and (max-width : 767px)"
                      query-matches="{{ mobileMedium }}"></iron-media-query>
    <iron-media-query query="(min-width : 768px) and (max-width : 991px)"
                      query-matches="{{ tablets }}"></iron-media-query>
    <iron-media-query query="(min-width : 767px) and (max-width : 1600px)"
                      query-matches="{{ screenLarge }}"></iron-media-query>

    <section class="section-product-features layout horizontal center center-justified wrap"
             mobile-small$="{{ mobileSmall }}"
             mobile-medium$="{{ mobileMedium }}"
             tablets$="{{ tablets }}"
             screen-large$="{{ screenLarge }}">

      <template
        is="dom-if"
        if="[[ _hasValue(featuresData.title) ]]">
        <h2 class="title">[[ featuresData.title ]]</h2>
      </template>

      <template
        is="dom-if"
        if="[[ featuresData.features.length ]]">
        <div class="row">

          <template
            is="dom-repeat"
            items="[[ featuresData.features ]]"
            as="feature">

            <div class="feature">
              <div class="feature-wrapper">

                <template
                  is="dom-if"
                  if="[[ _hasValue(feature.image) ]]">
                  <iron-image class="feature-image"
                              sizing="cover"
                              fade="true"
                              preload
                              placeholder="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAARUlEQVQYVx3LsQ2AQAwEwXPP9EIt9EADBOcMkRG8Lfk+MnrCHWltO709BIbgKdh+Pc0oeE5wFOy43/5jYQjGqOYQmGsrfE+bLy6etpfQAAAAAElFTkSuQmCC"
                              src$="[[ feature.image ]]">
                  </iron-image>
                </template>

                <div class="feature-content">

                  <template
                    is="dom-if"
                    if="[[ _hasValue(feature.title) ]]">
                    <h3 class="feature-title">[[ feature.title ]]</h3>
                  </template>

                  <template
                    is="dom-if"
                    if="[[ _hasValue(feature.description) ]]">
                    <div class="feature-description">
                      <dorel-safe-html html="[[ feature.description ]]"></dorel-safe-html>
                    </div>
                  </template>

                </div>
              </div>
            </div>

          </template>

        </div>
      </template>

    </section>
  </template>
  <script>
    Polymer({
      is: 'dorel-section-product-features',
      properties: {

        /**
         * @attribute
         * @name featuresData
         * @description coming from the page-builder this data object is filled
         * with ACF/Wordpress data about the component
         */
        featuresData: {
          type: Object,
          value: function () {
            return {};
          }
        }
      },

      /**
       * @name _hasValue
       * @description checks to see if a value is set
       *
       * @returns Boolean
       */
      _hasValue: function (val) {
        return (typeof val !== 'undefined' || val !== '');
      }
    });
  </script>
</dom-module>
