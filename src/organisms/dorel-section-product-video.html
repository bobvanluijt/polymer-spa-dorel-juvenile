<dom-module id="dorel-section-product-video">
  <template>
    <style>

      .section-product-video {
        width: 100%;
        float: left;
        padding: 1.5em var(--theme-gutter) 3em var(--theme-gutter);
        box-sizing: border-box;
      }

    </style>

    <!-- media queries -->
    <iron-media-query query="(max-width : 479px)"
                      query-matches="{{ mobileSmall }}"></iron-media-query>
    <iron-media-query query="(min-width : 480px) and (max-width : 767px)"
                      query-matches="{{ mobileMedium }}"></iron-media-query>
    <iron-media-query query="(min-width : 767px) and (max-width : 1600[x)"
                      query-matches="{{ screenLarge }}"></iron-media-query>

    <section class="section-product-video layout horizontal center center-justified wrap"
             mobile-small$="{{ mobileSmall }}"
             mobile-medium$="{{ mobileMedium }}"
             screen-large$="{{ screenLarge }}">
      
      <template
        is="dom-if"
        if="[[ videoData.video_id ]]">

        <div class="video">
          <div class="video-wrapper">
            <iframe src="https://www.youtube.com/embed/[[ videoData.video_id ]]" 
              frameborder="0" 
              allowfullscreen
              on-click="_iframeClick"></iframe>
          </div>
        </div>

      </template>

    </section>
  </template>
  <script>
    Polymer({
      is: 'dorel-section-product-video',
      properties: {

        /** 
         * @attribute
         * @name videoData
         * @description coming from the page-builder this data object is filled 
         * with ACF/Wordpress data about the component
         */
        videoData: {
          type: Object,
          value: function () {
            return {};
          }
        }
      },

      /**
       * @name iframeClick
       * @description handles clicks on the iframe
       */
      _iframeClick: function(event) {
        this.playVideo = !this.playVideo;

        this._eventTracking(event);
      },

      /**
       * @name _hasValue
       * @description checks to see if a value is set
       *
       * @returns Boolean
       */
      _hasValue: function (val) {
        return (typeof val !== 'undefined' || val !== '');
      },

      /**
       * @name _eventTracking
       * @description this is for cta tracking only
       * more info http://bit.ly/2nb6I7G
       *
       * @todo tracking isn't working currently, because an iframe is used for videos
       */
      _eventTracking: function(event) {

        var globals = Polymer.globalsManager.get('Dorel');

        /** 
         * Tracking on click for cta
         */
        Polymer.globalsManager.set('Dorel.events', {
          action: (this.playVideo) ? 'play' : 'stop',
          component: 'product-video',
          element: Polymer.dom(event).localTarget,
          event: 'polymer_event'
        });
      }
    });
  </script>
</dom-module>
