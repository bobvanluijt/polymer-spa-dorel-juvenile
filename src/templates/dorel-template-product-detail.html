<link rel="import" href="../organisms/dorel-section-product-accessories.html">
<link rel="import" href="../organisms/dorel-section-product-accordions.html">
<link rel="import" href="../organisms/dorel-section-product-features.html">
<link rel="import" href="../organisms/dorel-section-header.html">
<link rel="import" href="../organisms/dorel-section-product-showcase.html">
<link rel="import" href="../organisms/dorel-section-product-video.html">
<link rel="import" href="../organisms/dorel-section-product-usps.html">

<link rel="import" href="../utils/dorel-magento-collect-product.html">
<link rel="import" href="../utils/dorel-magento-collect-related-product.html">

<dom-module id="dorel-template-product-detail">
  <template>
    <style>
      :root {
        /* Override the default background-color for the multi sections */
        --theme-multi-background-color: var(--theme-color-background-tertiary);
        --theme-multi-no-background-color: transparent;
        --theme-multi-bottom-padding: var(--theme-component-space-inner-xlarge);
        float: left;
        width: 100%;
      }

      .wrapper {
        opacity: 0; /* make things invisible upon start */
        -webkit-animation: fadeIn ease 1; /* call our keyframe named fadeIn, use animattion ease-in and repeat it only 1 time */
        -moz-animation: fadeIn ease 1;
        animation: fadeIn ease 1;
        -webkit-animation-duration: 1s;
        -moz-animation-duration: .1s;
        animation-duration: 1s;
        -webkit-animation-fill-mode: forwards; /* this makes sure that after animation is done we remain at the last keyframe value (opacity: 1)*/
        -moz-animation-fill-mode: forwards;
        animation-fill-mode: forwards;
      }

      @-webkit-keyframes fadeIn {
        from {
          opacity: 0;
          opacity: 1 \9; /* IE9 only */
        }
        to {
          opacity: 1;
        }
      }

      @-moz-keyframes fadeIn {
        from {
          opacity: 0;
          opacity: 1 \9; /* IE9 only */
        }
        to {
          opacity: 1;
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          opacity: 1 \9; /* IE9 only */
        }
        to {
          opacity: 1;
        }
      }

      dorel-layout-section dorel-page-builder {
        width: 100%;
        display: flex;
      }
    </style>

    <dorel-magento-collect-product category="[[ category ]]" product-name="[[ routeData.productName ]]"></dorel-magento-collect-product>

    <dorel-magento-collect-related-product category="[[ category ]]" product-names="[[ product.relatedProducts ]]" related-products="{{ relatedProducts }}"></dorel-magento-collect-related-product>

    <!-- define routing for products -->
    <app-route
      route="{{ route }}"
      pattern="/:productName"
      data="{{ routeData }}"
      tail="{{ subroute }}"></app-route>

    <div class="wrapper">

      <template is="dom-if"
        if="[[ product ]]">
        <dorel-section-header
          section-header-data="[[ product.header_section ]]"
          gtm-parent="dorel-section-header"
          gtm-parent-index="[[ index ]]"></dorel-section-header>


        <dorel-section-product-showcase
          accessory-scroll-handler="{{ accessoryScrollHandler }}"
          showcase-data="[[ product ]]"
          gtm-parent="dorel-section-product-showcase"
          gtm-parent-index="[[ index ]]"></dorel-section-product-showcase>

        <!-- <dorel-section-product-usps
          usps-data="[[ component ]]"
          gtm-parent="dorel-section-product-usps"
          gtm-parent-index="[[ index ]]"></dorel-section-product-usps> -->

        <!-- <dorel-section-product-features
          features-data="[[ component ]]"
          gtm-parent="dorel-section-product-features"
          gtm-parent-index="[[ index ]]"></dorel-section-product-features> -->

          <p>[[ relatedProducts.accessories.length ]]</p>
        <template
          is="dom-if"
          if="{{ relatedProducts.accessories.length > 0}}">
          <dorel-section-product-accessories
            accessory-scroll-handler="{{ accessoryScrollHandler }}"
            accessories-data="[[ relatedProducts ]]"
            gtm-parent="dorel-section-product-accessories"
            gtm-parent-index="[[ index ]]"></dorel-section-product-accessories>
        </template>

        <!-- <dorel-section-product-accordions
          accordions-data="[[ product ]]"
          gtm-parent="dorel-section-product-accordions"
          gtm-parent-index="[[ index ]]"></dorel-section-product-accordions> -->

        <!-- <dorel-section-product-video
          video-data="[[ product.video_section ]]"
          gtm-parent="dorel-section-product-video"
          gtm-parent-index="[[ index ]]"></dorel-section-product-video> -->

        <!-- <dorel-section-slideshow
          slideshow-data="[[ component ]]"
          gtm-parent="dorel-section-slideshow"
          gtm-parent-index="[[ index ]]"></dorel-section-slideshow> -->
      </template>

    </div>

  </template>

  <script>
    Polymer({
      is: 'dorel-template-product-detail',

      properties: {

        /**
         * @attribute
         * @name templateData
         * @description the data coming from ACF/Wordpress which is delegated to the page builder
         */
        templateData: {
          type: String
        },

        /**
         * @name routeData
         * @description the route data contains the last segment under productName
         */
        routeData: {
          type: Object
        },

        /**
         * @name accessoryScrollHandler
         * @description the offset to the accessory section
         **/
        accessoryScrollHandler: {
          type: Boolean,
          notify: true,
          value: false,
        },

        category: {
          type: Number,
          value: 0
        },

        colorMap : {
          type: Array
        },

        relatedProducts: {
          type: Array
        }
      },

      observers: [
        '_setCurrentProduct(globals.Dorel.current.product)',
        '_setHeader(product)'
      ],

      _setCurrentProduct: function(currentProduct) {
        if(!currentProduct || !currentProduct.length) {
          return;
        }

        this.product = currentProduct[0];
      },

      _setHeader: function(product) {
        this.header = {
          background_image: product.name,
          title: product.name,
          sub_title: product.description
        }
      }

    });
  </script>
</dom-module>
