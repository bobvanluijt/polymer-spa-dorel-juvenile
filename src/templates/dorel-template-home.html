<dom-module id="dorel-template-home">
  <template>
    <style>
      .wrapper {
        float: left;
        width: 100%;
        padding-bottom: 1.5em;
      }
    </style>

    <!-- TODO: Replace dummy content with ACF Stuff-->
    <!-- <dorel-page-builder
      builder-data="[[ templateData.acf.page_builder ]]"
      template-data="[[ templateData ]]"></dorel-page-builder> -->

    <div class="wrapper">


      <div class="container layout horizontal center center-justified wrap">
        <div class="row">

          <!-- show when acf.page_builder has components -->
          <template
            is="dom-if"
            if="{{ templateData.acf.page_builder.length }}">

            <!-- iterate over page_builder components -->
            <template
              is="dom-repeat"
              items="[[ templateData.acf.page_builder ]]"
              as="component"
              targetFramerate="1000">

              <!-- section-hero-header -->
              <template 
                is="dom-if" 
                if="{{ isPageComponent(component.acf_fc_layout, 'section_hero_header') }}">
                
                <dorel-section-hero-header
                  hero-header-data="[[ component ]]"
                  gtm-parent="dorel-section-hero-header"
                  gtm-parent-index="[[ index ]]"></dorel-section-hero-header>

              </template>
              <!--// section-hero-header -->




              <!-- section-cta -->
              <template 
                is="dom-if" 
                if="{{ isPageComponent(component.acf_fc_layout, 'section_cta') }}">

                <dorel-section-cta
                  cta-data="[[ component ]]"
                  gtm-parent="dorel-section-cta"
                  gtm-parent-index="[[ index ]]"></dorel-section-cta>

              </template>
              <!--// section-cta -->





              <!-- dorel section heroes -->
              <template 
                is="dom-if" 
                if="{{ isPageComponent(component.acf_fc_layout, 'section_heroes') }}">
                
                <dorel-section-heroes 
                  heroes-data="[[ component ]]"
                  gtm-parent="dorel-section-heroes"
                  gtm-parent-index="[[ index ]]"></dorel-section-heroes>

              </template>
              <!--// dorel section heroes -->




              <!-- section-cards -->
              <template 
                is="dom-if" 
                if="{{ isPageComponent(component.acf_fc_layout, 'section_cards') }}">

                <dorel-section-cards
                  cards-data="[[ component ]]"
                  gtm-parent="dorel-section-cards"
                  gtm-parent-index="[[ index ]]"></dorel-section-cards>

              </template>
              <!--// section-cards -->

            </template>

          </template>

        </div>
      </div>


    </div>
    
  </template>

  <script>
    Polymer({
      is: 'dorel-template-home',

      properties: {
          
        /**
         * @attribute
         * @name templateData
         * @description the data coming from ACF/Wordpress which is delegated to the page builder
         */
        templateData: {
          type: String
        }

      },

      /** 
       * @name isPageComponent
       * @description compares to values to see if they match, for some
       * components they can be doubled. They will always be suffixed with
       * their number like section_multi and section_multi_2. In those
       * cases we need to treat them as section_multi's.
       *
       * @returns Boolean if the two values match or not (true/false)
       */
      isPageComponent: function(response, cname) {

        // get last char
        var lastChar = response.substr(response.length - 1);

        // find out if it is a number
        var isNumber = !isNaN(Number(lastChar));
        
        // if it is a number treat it accordingly
        if (isNumber) {
          var keyArr = response.split('_');
          keyArr.pop();
          strippedResponse = keyArr.join('_');

          return strippedResponse === cname;
        }

        // all other cases just compare them
        return response === cname;
      }

    });
  </script>
</dom-module>
