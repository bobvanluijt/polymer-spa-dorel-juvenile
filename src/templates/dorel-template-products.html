<link rel="import" href="../organisms/dorel-page-builder.html">

<dom-module id="dorel-template-products">
  <template>
    
    <!-- define routing for products -->
    <app-route
        route="{{ route }}"
        pattern="/:productName"
        data="{{ routeData }}"
        tail="{{ subroute }}"></app-route>

    <dorel-page-builder 
      builder-data="[[ builderData.acf.page_builder ]]"
      template-data="[[ builderData ]]"></dorel-page-builder>

  </template>

  <script>
    Polymer({
      is: 'dorel-template-products',

      properties: {

        /**
         * @attribute
         * @name templateData
         * @description the data coming from ACF/Wordpress which is delegated to the page builder
         */
        templateData: {
          type: String
        },

        /**
         * @name routeData
         * @description the route data contains the last segment under productName
         */
        routeData: {
          type: Object
        }
        
      },

      observers: [
        '_routeDataChanged(routeData.productName)'
      ],

      _routeDataChanged: function(productName) {
        if (typeof productName === 'undefined' || typeof this.templateData.products === 'undefined' ||
          !this.templateData.products.length) return;

        
        this.builderData = this.templateData.products.find(function(product) {
          return product.slug === productName;
        });

        if (typeof this.builderData === 'undefined') {
          console.log('404');
        }
      }

    });
  </script>
</dom-module>
