<dom-module id="dorel-product-color-map">
  <template>
    <iron-ajax
      id="colorMap"
      content-type="application/json"
      method="get"
      input="1"
      handle-as="json"
      on-response="_colorMapResponse"></iron-ajax>
  </template>

  <script>
    Polymer({
      is: 'dorel-product-color-map',
      properties: {

        colorMap: {
          type: Array,
          notify: true
        },

        token: {
          type: String
        },

        /**
         * @attribute
         * @name appCache
         * @description the temporary cache of the application,
         * contains data that used to be contained by the globalsManager
         */
        appCache: {
          type: Object
        }

      },

      observers: [
        '_getColorMapping(token)'
      ],

      _getColorMapping: function(token) {
        if(!token) {
          return;
        }
        var colorMap =  this.get('appCache.product.colorMap');

        if(colorMap && colorMap.length) {
          this.colorMap = colorMap;
        } else {
          var colorMapEl = this.$.colorMap;
          colorMapEl.headers = {Authorization: 'Bearer ' + this.token};
          colorMapEl.url = CONFIG.ECOM_URL + '/rest/V1/products/attributes/car_seat_color/swatchoptions';
          colorMapEl.generateRequest();
        }
      },

      _colorMapResponse: function(response) {
        var colorMap = response.detail.response;
        this.set('colorMap', colorMap);
        this.fire('setAppCache', { value: colorMap, path: 'product.colorMap' });
      }
    });
  </script>
</dom-module>
