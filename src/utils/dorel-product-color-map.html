<dom-module id="dorel-product-color-map">
  <template>
    <iron-ajax
      id="colorMap"
      content-type="application/json"
      method="get"
      input="1"
      handle-as="json"
      on-response="_colorMapResponse"></iron-ajax>
  </template>

  <script>
    Polymer({
      is: 'dorel-product-color-map',
      properties: {

        colorMap: {
          type: Array,
          notify: true
        },

        token: {
          type: String
        }

      },

      observers: [
        '_getColorMapping(token)'
      ],

      _getColorMapping: function(token) {
        if(!token) {
          return;
        }
        var colorMap =  Polymer.globalsManager.get('Dorel.product.colorMap');
        if(colorMap && colorMap.length) {
          this.colorMap = colorMap;
        } else {
          var colorMapEl = this.$.colorMap;
          colorMapEl.headers = {Authorization: 'Bearer ' + this.token};
          colorMapEl.url = CONFIG.ECOM_URL + '/rest/V1/products/attributes/car_seat_color/options';
          colorMapEl.generateRequest();
        }
      },

      _colorMapResponse: function(response) {
        this.colorMap= response.detail.response;
        Polymer.globalsManager.set('Dorel.product.colorMap', this.colorMap);
      }
    });
  </script>
</dom-module>
