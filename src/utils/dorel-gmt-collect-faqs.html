<link rel="import" href="./behaviors/single/dorel-merge-arrays-behavior.html">

<dom-module id="dorel-gmt-collect-faqs">
  <template>
    <iron-ajax
      auto
      url="[[ endPoint ]]"
      handle-as="json"
      on-response="_faqsLoaded"></iron-ajax>
  </template>

  <script>
    Polymer({
      is: 'dorel-gmt-collect-faqs',
      properties: {

        /**
         * @attribute
         * @name endpointSegments
         * @description the segments that are added behind the GMT url, separate
         * multiple segments with '/'
         */
        endpointSegments: {
          type: String,
        },

        /**
         * @name endPoint
         * @description the full endpoint url that iron-ajax uses to do the call
         * to the GMT
         */
        endPoint: {
          type: String
        },

        /**
         * @attribute
         * @name appCache
         * @description the cache of the application will contain the currentLanguage
         */
        appCache: {
          type: Object
        }
      },

      behaviors: [
        MergeArraysBehavior
      ],

      observers: [
        '_defineEndpoint(endpointSegments, appCache.currentLanguage)'
      ],

      /**
       * @observer
       * @name _defineEndpoint
       * @description will check if the endpointSegments are changed and creates an
       * endpoint url, which will do the api call automatically
       */
      _defineEndpoint: function(segments, currentLanguage) {
        if(!segments || !currentLanguage || !currentLanguage.languageCode) {
          return;
        }

        // set the endPoint variable which will kick off the iron-ajax
        this.set('endPoint', CONFIG.DIO_API_URL + '/service-topics/' + segments + '&translations=1&iso_code=' + currentLanguage.languageCode);
      },

      /**
       * @name _faqsLoaded
       * @description when the endpoint gives a response we set the apiResponse,
       * which will reflect to the attribute
       */
      _faqsLoaded: function(data) {
        var response = data.detail.response;

        if(typeof response !== 'undefined') {
          var faqsGlobals = this.get('appCache.faqs') || [];
          var faqs = this._mergeArrays(faqsGlobals, response, 'id');

          this.fire('setAppCache', { value: faqs, path: 'faqs' });
        }
      }
    });
  </script>
</dom-module>
