<dom-module id="dorel-gmt-collect-faqs">
  <template>
    <iron-ajax
      auto
      url="[[ endPoint ]]" 
      handle-as="json" 
      on-response="_faqsLoaded"></iron-ajax>
  </template>
  
  <script>
    Polymer({
      is: 'dorel-gmt-collect-faqs',
      properties: {

        /**
         * `apiCall` the last segment of the api call
         */
        apiCall: {
          type: String
        },

        /** 
         * `featureQuaestions` adds the queryParam to the endpoint call, the
         * response will add a featured_questions array to each main category
         */
        featuredQuestions: {
          type: Boolean
        },

        /**
         * `apiResponse` will be used to update the attribute up the tree,
         * hence the reflectToAttribute. This way the response will be used
         * in the code where this component is placed
         */
        apiResponse: {
          type: Object,
          value: function() {
            return {};
          },
          notify: true,
          reflectToAttribute: true
        },

        /**
         * `endPoint` complete url and segment for the endpoint call to make by
         * the iron-ajax
         */
        endPoint: {
          type: String
        }
      },

      observers: [
        '_defineEndpoint(apiCall, featuredQuestions)'
      ],

      /**
       * @name ready
       * @description will check if the apiCall isset and then sets the endpoint which
       * will initiate the call in the iron-ajax
       */
      _defineEndpoint: function(apiCall, featuredQuestions) {
        if (typeof apiCall === 'undefined' || apiCall === '') {
          console.error('no apiCall attribute defined, please provide the right apiCall as an attribute');
          return;
        }

        var featured = (typeof featuredQuestions === 'undefined'|| !featuredQuestions) ?
         '' : '&featured_questions=1';

        this.set('endPoint', CONFIG.DIO_API_URL + '/' + apiCall + featured);
      },

      /** 
       * @name _faqsLoaded
       * @description when the endpoint gives a response we set the apiResponse,
       * which will reflect to the attribute
       */
      _faqsLoaded: function(data) {
        this.set('apiResponse', data.detail.response);
      }
    });
  </script>
</dom-module>