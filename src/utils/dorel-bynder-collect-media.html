<link rel="import" href="../redux/dorel-redux.html">

<dom-module id="dorel-bynder-collect-media">
  <template>
  </template>

  <script>
  class DorelBynderCollectMedia extends ReduxMixin(Polymer.Element) {
    static get is() { return 'dorel-bynder-collect-media'; }
    static get properties() {
      return {
        /**
         * @name mediaId
         * @description The Bynder media ID used to retrieve assets
         */
        mediaId: {
          type: String,
          value: '',
          observer: '_onMediaIdChange'
        },
        /**
         * @name mediaContent
         * @description the content retrieved using from Bynder
         */
        mediaContent: {
          type: Object,
          statePath: function(state) {
            return this._findImageFromState(state);
          },
          notify: true
        }
      };
    }

    /**
     * state observer
     * @name findImageFromState
     * @description Everytime the state change it will return according to the conditionals
     */
    _findImageFromState(state) {
      if(state && state.images && state.images.length && this.mediaId) {
        const image = state.images.find(image => image.id === this.mediaId && image.isLoading === false)
        if(image && this.mediaContent && this.mediaContent.id !== this.mediaId) {
          return Object.assign({}, image);
        } else {
          return {};
        }
      }
    }

    /**
     * @name _onMediaIdChange
     * @description if the mediaId changes it will dispatch a action
     */
    _onMediaIdChange() {
     if (this.mediaId) {
        this.dispatch('fetchImageById', this.mediaId);
      }
    }

  }
  customElements.define(DorelBynderCollectMedia.is, DorelBynderCollectMedia);
  </script>

</dom-module>
