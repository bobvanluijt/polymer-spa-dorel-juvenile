<link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selectable.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../molecules/dorel-navigation-sub.html">
<link rel="import" href="../molecules/dorel-tab.html">

<dom-module id="dorel-navigation-main">
  <template strip-whitespace>
    <style include="iron-flex iron-flex-alignment">
      app-drawer {
        z-index: 1000;
      }
      .menu-spacer-top {
        height: 2.6rem;
        width: 100%;
        display: flex;
      }

      paper-item {

      }

      .mobile-menu-item {
		    text-decoration: none;
	      color: var(--theme-color-black);
	      text-transform: capitalize;
      }
      .mobile-menu-item:hover, .mobile-menu-item:focus {
	      color: var(--theme-color-text-link-active);
      }

      dorel-tab:not(:first-child) {
        padding-left: 1rem;
      }
      paper-submenu .menu-content {
        background-color: var(--theme-color-monochrome-2);
      }

      dorel-tabs, dorel-tab {
        height: var(--theme-scale-3);
      }

      /* new styling */
      dorel-tab {
        padding: 0 var(--theme-scale-3);
        text-transform: capitalize;
      }

      dorel-tab a {
        color: var(--theme-color-black);
        text-decoration: none;
      }

      dorel-tab a:hover,  dorel-tab a:focus {
        color: var(--theme-color-text-link-active);
        cursor: pointer;
      }

      dorel-tab, dorel-safe-html {
        float: left;
        display: inline-block;
      }

    </style>

    <iron-media-query query="(max-width : 767px)"
      query-matches="{{ screenSmall }}"></iron-media-query>
    <iron-media-query query="(min-width : 768px) and (max-width : 991px)"
      query-matches="{{ screenMedium }}"></iron-media-query>
    <iron-media-query query="(min-width : 768px)"
      query-matches="{{ screenMediumUp }}"></iron-media-query>

    <!--
      Mobile menu
    -->
    <app-drawer opened="{{ mobileMenuOpened }}" swipe-open tabindex="0">

      <div class="menu-spacer-top"></div>
      <template
        is="dom-if"
        if="[[ globals.Dorel.collect.menus.main_menu.items.length ]]">
        <iron-selector role="navigation" class="drawer-list"
          selected="[[ page ]]"
          attr-for-selected="name">
          <paper-menu>
            <template
              is="dom-repeat"
              items="{{ globals.Dorel.collect.menus.main_menu.items }}"
              as="menuItem"
              initial-count="4">

              <!-- if not children -->
              <template
                is="dom-if"
                if="[[ !menuItem.children.length ]]">
                <a class="mobile-menu-item" href="[[ menuItem.url ]]" title="[[ menuItem.title ]]"
                  on-click="menuItemClicked">
                  <paper-item><dorel-safe-html html="[[ menuItem.title ]]"></dorel-safe-html></paper-item>
                </a>
              </template>

              <!-- if has children (submenu) -->
              <template
                is="dom-if"
                if="[[ menuItem.children.length ]]">

                <!-- Important! Make sure to expose the
                 - mobileMenuOpened
                 - searchOpened
                 - subMenuOpened
                -->
                <dorel-navigation-sub
                  active-id="{{ activeId }}"
                  menu-item="{{ menuItem }}"
                  mobile-menu-opened="{{ mobileMenuOpened }}"
                  search-opened="{{ searchOpened }}"
                  sub-menu-opened="{{ subMenuOpened }}"></dorel-navigation-sub>
              </template>
            </template>
            <!-- 
              Removed in favor of DIO-588
              <paper-item>language selector</paper-item>
            
              Removed in favor of DIO-734
              <a class="mobile-menu-item" href="" title="Support"
                 on-click="menuItemClicked">
                <paper-item>Support</paper-item>
              </a> 
            -->
          </paper-menu>
        </iron-selector>
      </template>

    </app-drawer>

    <!--
    Menu for medium and larger screens

    TODO: revamp the menu structure so that it's not only
    for medium up only, but also for smaller screens
    -->
    <template is="dom-if" if="{{ screenMediumUp }}">

      <!-- only show if menu contains items -->
      <template
        is="dom-if"
        if="[[ globals.Dorel.collect.menus.main_menu.items.length ]]">
        <nav
          role="navigation"
          screenMedium$="{{ screenMedium }}">
          <dorel-tabs
            selected="[[ page ]]"
            attr-for-selected="name">
            <div class="layout horizontal center">
              <!-- loop through the menu items -->
              <template
                is="dom-repeat"
                items="{{ globals.Dorel.collect.menus.main_menu.items }}"
                as="menuItem">

                <!-- if menu doesn't have children just show the menu item -->
                <template
                  is="dom-if"
                  if="[[ !menuItem.children.length ]]">
                  <div>
                    <dorel-tab
                      name="[[ menuItem.title ]]">
                        <a href="[[ menuItem.url ]]" title="[[ menuItem.title ]]"
                          on-click="menuItemClicked">
                          <dorel-safe-html html="[[ menuItem.title ]]"></dorel-safe-html>
                        </a>
                    </dorel-tab>
                  </div>
                </template>


                <!-- if menu item has children:
                 - show visual indicator
                 - add the children in submenu
                 -->
                <template
                  is="dom-if"
                  if="[[ menuItem.children.length ]]">

                  <!-- Important! Make sure to expose the
                   - mobileMenuOpened
                   - searchOpened
                   - subMenuOpened
                  -->
                  <dorel-navigation-sub
                    active-id="{{ activeId }}"
                    menu-item="{{ menuItem }}"
                    mobile-menu-opened="{{ mobileMenuOpened }}"
                    search-opened="{{ searchOpened }}"
                    sub-menu-opened="{{ subMenuOpened }}"></dorel-navigation-sub>

                      <!-- <div>
                        <ul class="submenu">
                          <li><strong>aList title:</strong></li>
                          <li>Another list item 1</li>
                          <li>Another list item 2</li>
                          <li>Another list item 3</li>
                        </ul>
                      </div>
                      <div>
                        <ul class="submenu">
                          <li><strong>aList title:</strong></li>
                          <li>Another list item 1</li>
                          <li>Another list item 2</li>
                          <li>Another list item 3</li>
                        </ul>
                      </div> -->
                    </section>
                  </div>
                </div>
              </template>
            </template>
          </dorel-tabs>
        </nav>
      </template>

    </template>

  </template>
  <script>
    Polymer({

      is: 'dorel-navigation-main',

      properties: {

        /**
         * @attribute
         * @name mobileMenuOpened
         * @description variable indicator for the mobile menu to be opened/closed
         */
        mobileMenuOpened: {
          type: Boolean,
          value: false,
          notify: true
        },

        /**
         * @attribute
         * @name subMenuOpened
         * @description variable that indicates that one of the submenus
         * is opened
         */
        subMenuOpened: {
          type: Boolean,
          value: false,
          notify: true
        },

        /**
         * @attribute
         * @name searchOpened
         * @description variable indicator for the search to be opened/closed
         */
        searchOpened: {
          type: Boolean,
          value: false,
          notify: true
        }

      },

      /**
       * @name menuItemClicked
       * @description handles all menu item clicks
       */
      menuItemClicked: function(event) {
        // reset all handlers
        this.mobileMenuOpened = false;
        this.subMenuOpened = false;
        this.searchOpened = false;

        // send event data to tracking function
        this._eventTracking(event);
      },

      /**
       * @name _eventTracking
       * @description sets the right properties for event tracking
       */
      _eventTracking: function(event) {
        Polymer.globalsManager.set('Dorel.events', {
          action: 'switch',
          component: 'navigation',
          element: Polymer.dom(event).localTarget,
          event: 'polymer_event',
          things: {
            'currentPage': document.URL,
            'targetPage': Polymer.dom(event).localTarget.href
          }
        });
      }
    });
  </script>
</dom-module>
