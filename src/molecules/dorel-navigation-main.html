<dom-module id="dorel-navigation-main">
  <template strip-whitespace>
    <style include="theme-maxicosi-shared-styles iron-flex iron-flex-alignment">
      app-drawer {
        z-index: 1000;
      }
      .menu-spacer-top {
        height: 2.6rem;
        width: 100%;
        display: flex;
      }
      /*dorel-tab {
        padding-top: 1rem;
        padding-bottom: 1rem;
        padding-right: 1rem;
      }
      dorel-tab a {
        color: var(--theme-primary-text-color);
        text-decoration: none;
        text-transform: capitalize;
      }
      dorel-tab a:hover {
        color: var(--theme-color-hover);
      }*/
      dorel-tab:not(:first-child) {
        padding-left: 1rem;
      }
      paper-submenu .menu-content {
        background-color: var(--theme-color-background-tertiary);
      }

      /* new styling */
      dorel-tab {
        padding: 5px 10px;
        margin: 0 10px;
        text-transform: capitalize;
      }
      dorel-tab a {
        color: var(--theme-primary-text-color);
        text-decoration: none;
      }
      dorel-tab:hover {
        color: var(--theme-color-hover);
      }
      dorel-tab.has-submenu:hover {
        cursor: pointer;
      }
      .section-secondary-menu {
        background-color: #F5F5F5;
        width: 100%;
        left: 0;
        position: absolute;
        margin-top: 3rem;
      }
      .hidden {
        visibility: hidden;
        opacity: 0;
      }
      .menu-item-container[opened] .section-secondary-menu.hidden {
        visibility: visible;
        opacity: 1;
      }
      .submenu {
        list-style-type: none;
      }
      .submenu a {
        color: var(--theme-primary-text-color);
        text-decoration: none;
        text-transform: capitalize;
      }
    </style>

    <iron-media-query query="(max-width : 767px)"
      query-matches="{{ screenSmall }}"></iron-media-query>
    <iron-media-query query="(min-width : 768px) and (max-width : 991px)"
      query-matches="{{ screenMedium }}"></iron-media-query>
    <iron-media-query query="(min-width : 768px)"
      query-matches="{{ screenMediumUp }}"></iron-media-query>
    
    <!--
      Mobile menu
    -->
    <app-drawer opened="{{ mobileMenuOpened }}" swipe-open tabindex="0">
      <div class="menu-spacer-top">
      </div>
      <template 
        is="dom-if" 
        if="[[ globals.Dorel.collect.menus.main_menu.items.length ]]">
        <iron-selector role="navigation" class="drawer-list" 
          selected="[[ page ]]" 
          attr-for-selected="name">
          <paper-menu>
            <template 
              is="dom-repeat" 
              items="{{ globals.Dorel.collect.menus.main_menu.items }}"
              as="menuItem" 
              initial-count="4">
              
              <!-- if not children -->
              <template
                is="dom-if"
                if="[[ !menuItem.children.length ]]">
                <a href="[[ menuItem.url ]]" title="[[ menuItem.title ]]"
                  on-click="menuItemClicked">
                  <paper-item>[[ menuItem.title ]]</paper-item>
                </a>
              </template>

              <!-- if has children (submenu) -->
              <template
                is="dom-if"
                if="[[ menuItem.children.length ]]">

                <paper-submenu submenu-opened$="{{ subMenuOpened }}">
                  <paper-item class="menu-trigger layout horizontal justified"
                    on-click="dropdownToggle">
                    [[ menuItem.title ]]
                    <template
                      is="dom-if"
                      if="{{ subMenuOpened }}">
                      <iron-icon icon="dorel-icons:expand-less"></iron-icon>
                    </template>
                    <template
                      is="dom-if"
                      if="{{ !subMenuOpened }}">
                      <iron-icon icon="dorel-icons:expand-more"></iron-icon>
                    </template>
                  </paper-item>
                  <paper-menu class="menu-content">
                    <template
                      is="dom-repeat"
                      items="[[ menuItem.children ]]"
                      as="child">
                      <a href="[[ child.url ]]" title="[[ child.title ]]"
                        on-click="menuItemClicked">
                        <paper-item>[[ child.title ]]</paper-item>
                      </a>
                    </template>
                  </paper-menu>
                </paper-submenu>
              </template>
            </template>
            <paper-item>language selector</paper-item>
            <paper-item>support</paper-item>
          </paper-menu>
        </iron-selector>
      </template>
    </app-drawer>

    <!--
    Menu for medium and larger screens

    TODO: revamp the menu structure so that it's not only
    for medium up only, but also for smaller screens
    -->
    <template is="dom-if" if="{{ screenMediumUp }}">
 
      <!-- only show if menu contains items -->
      <template 
        is="dom-if" 
        if="[[ globals.Dorel.collect.menus.main_menu.items.length ]]">
        <nav 
          role="navigation" 
          screenMedium$="{{ screenMedium }}">
          <dorel-tabs
            selected="[[ page ]]"
            attr-for-selected="name">
            <div class="layout horizontal center">
              <!-- loop through the menu items -->
              <template 
              is="dom-repeat" 
              items="{{ globals.Dorel.collect.menus.main_menu.items }}" 
              as="menuItem" 
              initial-count="4">
                <template 
                  is="dom-if"
                  if="[[ !menuItem.children.length ]]">
                  <!-- if menu doesn't have children just show the menu item -->
                  <div>
                    <dorel-tab 
                      name="[[ menuItem.title ]]"
                      opened$="{{ subMenuOpened }}">
                        <a href="[[ menuItem.url ]]" title="[[ menuItem.title ]]">
                          [[ menuItem.title ]]
                        </a>
                    </dorel-tab>
                  </div>
                </template>
                <template 
                  is="dom-if"
                  if="[[ menuItem.children.length ]]">
                  <!-- if menu item has children: 
                   - show visual indicator 
                   - add the children in submenu
                   -->
                  <div class="menu-item-container" opened$="{{ subMenuOpened }}">
                    <dorel-tab
                      class="has-submenu" 
                      name="[[ menuItem.title ]]"
                      on-click="dropdownToggle">
                      [[ menuItem.title ]]
                      <template
                        is="dom-if"
                        if="{{ subMenuOpened }}">
                        <iron-icon icon="dorel-icons:expand-less"></iron-icon>
                      </template>
                      <template
                        is="dom-if"
                        if="{{ !subMenuOpened }}">
                        <iron-icon icon="dorel-icons:expand-more"></iron-icon>
                      </template>
                    </dorel-tab>
                    <section class="section-secondary-menu layout horizontal hidden">
                      <!--
                        @Marnix:
                        TODO: Iterate through submenu's
                      -->
                      <div>
                        <ul class="submenu">
                          <template
                            is="dom-repeat"
                            items="[[ menuItem.children ]]"
                            as="child">
                            <li>
                              <a href="[[ child.url ]]">[[ child.title ]]</a>
                            </li>
                          </template>
                        </ul>
                      </div>
                      <div>
                        <ul class="submenu">
                          <li><strong>aList title:</strong></li>
                          <li>Another list item 1</li>
                          <li>Another list item 2</li>
                          <li>Another list item 3</li>
                        </ul>
                      </div>
                      <div>
                        <ul class="submenu">
                          <li><strong>aList title:</strong></li>
                          <li>Another list item 1</li>
                          <li>Another list item 2</li>
                          <li>Another list item 3</li>
                        </ul>
                      </div>
                    </section>
                  </div>
                </div>
              </template>
            </template>
          </dorel-tabs>
        </nav>
      </template>

    </template>

  </template>
  <script>
    Polymer({

      is: 'dorel-navigation-main',

      properties: {

        // Is exposed in host element
        mobileMenuOpened: {
          type: Boolean,
          value: false,
          notify: true
        },

        subMenuOpened: {
          type: Boolean,
          value: false,
          notify: true
        },

        searchOpened: {
          type: Boolean,
          value: false,
          notify: true
        }

        // _shouldShowTabs: {
        //   computed: '_computeShouldShowTabs(page)'
        // },

        // _shouldRenderTabs: {
        //   computed: '_computeShouldRenderTabs(_shouldShowTabs, loadComplete)'
        // },

        // _shouldRenderDrawer: {
        //   computed: '_computeShouldRenderDrawer(loadComplete)'
        // }

      },

      // _computeShouldRenderDrawer: function(loadComplete) {
      //   return loadComplete && (this.screenExtraSmall || this.screenSmall );
      //   console.log('test!');
      // },

      /**
       * When a dropdown item is clicked
       */
      dropdownToggle: function(e) {
        console.log('works!');

        var self = this;

        e.preventDefault();

        this.searchOpened = false;
        this.subMenuOpened = !this.subMenuOpened;

        window.onscroll = function (e) {
          self.subMenuOpened = false;
        } 
      },

      menuItemClicked: function(e) {
        this.mobileMenuOpened = false;
        this.subMenuOpened = false;
        this.searchOpened = false;
        return;
      }
    });
  </script>
</dom-module>


