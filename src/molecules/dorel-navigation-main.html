<dom-module id="dorel-navigation-main">
  <template strip-whitespace>
    <style include="theme-maxicosi-shared-styles  iron-flex iron-flex-alignment">

      dorel-tab {
        padding-top: 1rem;
        padding-bottom: 1rem;
        padding-right: 1rem;
      }

      dorel-tab a {
        color: var(--theme-primary-text-color);
        text-decoration: none;
        text-transform: capitalize;
      }

      dorel-tab a:hover {
        color: var(--theme-color-hover);
      }

      dorel-tab:not(:first-child) {
        padding-left: 1rem;
      }

    </style>

    <iron-media-query query="(max-width : 767px)"
      query-matches="{{ screenSmall }}"></iron-media-query>
    <iron-media-query query="(min-width : 768px) and (max-width : 991px)"
      query-matches="{{ screenMedium }}"></iron-media-query>
    <iron-media-query query="(min-width : 768px)"
      query-matches="{{ screenMediumUp }}"></iron-media-query>

    <!-- 
      Lazy-create the drawer for small screen sizes. 

      TODO: integrate the drawer for mobile only
    -->

    <!--template 
      is="dom-if" 
      if="[[ _shouldRenderDrawer ]]"-->


      <app-drawer opened="{{ mobileMenuOpened }}" swipe-open tabindex="0">

        <div class="layout vertical">
          <div class="layout horizontal justified center header-top">
            <div>
              <!--paper-icon-button
                class="paper-icn-big"
                icon="close"
                on-click="_toggleDrawer"
                aria-label="close-menu"
                style="">
              </paper-icon-button-->
            </div>
          </div>
          <div>
            <template 
              is="dom-if" 
              if="[[ globals.Dorel.collect.menus.main_menu.items.length ]]">
              <iron-selector role="navigation" class="drawer-list" 
                selected="[[ page ]]" 
                attr-for-selected="name">
                <paper-menu>

                  <template 
                    is="dom-repeat" 
                    items="{{ globals.Dorel.collect.menus.main_menu.items }}"
                    as="menuItem" 
                    initial-count="4">
                    
                    <!-- if not children -->
                    <template
                      is="dom-if"
                      if="[[ !menuItem.children.length ]]">
                      <a href="[[ menuItem.url ]]" title="[[ menuItem.title ]]">
                        <paper-item>[[ menuItem.title ]]</paper-item>
                      </a>
                    </template>

                    <!-- if has children (submenu) -->
                    <template
                      is="dom-if"
                      if="[[ menuItem.children.length ]]">

                      <paper-submenu submenu-opened$="{{ subMenuOpened }}">
                        <paper-item class="menu-trigger layout horizontal justified" on-click="_toggleSubmenuIcon">
                          [[ menuItem.title ]] 
                          <iron-icon icon="dorel-icons:expand-more" class="menu-trigger-icon"></iron-icon>
                        </paper-item>
                        <paper-menu class="menu-content">
                          <template
                            is="dom-repeat"
                            items="[[ menuItem.children ]]"
                            as="child">
                            <a href="[[ child.url ]]" title="[[ child.title ]]">
                              <paper-item>[[ child.title ]]</paper-item>
                            </a>
                          </template>
                        </paper-menu>
                      </paper-submenu>
                    </template>
                  </template>

                  <paper-item>language selector</paper-item>
                  <paper-item>support</paper-item>
                </paper-menu>
              </iron-selector>
            </template>
          </div>
        </div>

      </app-drawer>
    <!--/template-->


    <!--
    Menu for medium and larger screens

    TODO: revamp the menu structure so that it's not only
    for medium up only, but also for smaller screens
    -->

    <template is="dom-if" if="{{ screenMediumUp }}">

      <nav id="header-main-menu" role="navigation" screenMedium$="{{ screenMedium }}">

        <template 
            is="dom-if" 
            if="[[ globals.Dorel.collect.menus.main_menu.items.length ]]">

            <dorel-tabs
              selected="[[ page ]]"
              attr-for-selected="name">
              <template 
                is="dom-repeat" 
                items="{{ globals.Dorel.collect.menus.main_menu.items }}" 
                as="menuItem" 
                initial-count="4">

                <dorel-tab name="[[ menuItem.title ]]">

                  <template
                    is="dom-if"
                    if="[[ menuItem.children.length ]]">
                    <paper-dropdown-menu label="[[ menuItem.title ]]">
                      <paper-listbox class="dropdown-content">
                        <template
                          is="dom-repeat"
                          items="[[ menuItem.children ]]"
                          as="child">
                          <paper-item>
                            <a
                              href="[[ child.url ]]"
                              title="">
                              <!-- [[ child ]] -->
                              [[ child.title ]]
                            </a>
                          </paper-item>
                        </template>
                      </paper-listbox>
                    </paper-dropdown-menu>
                  </template>

                  <template
                    is="dom-if"
                    if="[[ !menuItem.children.length ]]">
                    <a href="[[ menuItem.url ]]">[[ menuItem.title ]]</a>
                  </template>
                </dorel-tab>

              </template>
            </dorel-tabs>

        </template>

      </template>

      <!-- template 
        is="dom-if" 
        if="[[ _shouldRenderTabs ]]">
        <template 
          is="dom-if" 
          if="[[ globals.Dorel.collect.menus.main_menu.items.length ]]">

          <dorel-tabs
            selected="[[ page ]]"
            attr-for-selected="name">
            <template 
              is="dom-repeat" 
              items="{{ globals.Dorel.collect.menus.main_menu.items }}" 
              as="menuItem" 
              initial-count="4">

              <dorel-tab name="[[ menuItem.title ]]">

                <template
                  is="dom-if"
                  if="[[ menuItem.children.length ]]">

                  <paper-dropdown-menu label="[[ menuItem.title ]]">
                    <paper-listbox class="dropdown-content">

                      <template
                        is="dom-repeat"
                        items="[[ menuItem.children ]]"
                        as="child">
                        <paper-item>
                          <dorel-cta
                            link="[[ child.url ]]">
                            [[ child.title ]]
                          </dorel-cta>
                        </paper-item>
                      </template>
                    </paper-listbox>
                  </paper-dropdown-menu>

                </template>

                <template
                  is="dom-if"
                  if="[[ !menuItem.children.length ]]">
                  <a href="[[ menuItem.url ]]">[[ menuItem.title ]]</a>
                </template>
              </dorel-tab>

            </template>
          </dorel-tabs>

        </template>
      </template-->
    </nav>

  </template>
  <script>
    Polymer({

      is: 'dorel-navigation-main',

      properties: {

        // Is exposed in host element
        mobileMenuOpened: {
          type: Boolean
        },

        // _shouldShowTabs: {
        //   computed: '_computeShouldShowTabs(page)'
        // },

        // _shouldRenderTabs: {
        //   computed: '_computeShouldRenderTabs(_shouldShowTabs, loadComplete)'
        // },

        // _shouldRenderDrawer: {
        //   computed: '_computeShouldRenderDrawer(loadComplete)'
        // }

      },


      // _computeShouldRenderDrawer: function(loadComplete) {
      //   return loadComplete && (this.screenExtraSmall || this.screenSmall );
      //   console.log('test!');
      // },

    });
  </script>
</dom-module>


