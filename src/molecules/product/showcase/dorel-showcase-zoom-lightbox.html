<dom-module id="dorel-showcase-zoom-lightbox">
  <template>
    <style>
      :host {
        position: relative;
        z-index: 99999999;
      }
      .overlay {
        position: fixed;
        display: block;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0,0,0, 0.4);
        visibility: hidden;
        opacity: 0;
        padding: 1.5rem;
        box-sizing: border-box;
        transition: 0.35s;
        cursor: pointer;
        cursor: zoom-out;
      }
      .overlay[active] {
        opacity: 1;
        visibility: visible;
      }
      .image {
        width: 100%;
        height: calc(100vh - 3rem);
        margin: auto;
        float: none;
        display: block;
      }
      .overlay-wrapper {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate( -50%, -50% );
        height: calc(100vh - 3rem);
        width: inherit;
        cursor: default;
      }
      .overlay-arrow {
        position: absolute;
        top: 50%;
        left: 0;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        line-height: 50px;
        text-align: center;
        box-shadow: 0 0 1px 1px rgba( 0, 0, 0, .1);
        transition: .2s;
      }

      .overlay-arrow:hover {
        box-shadow: 0 0 2px 2px rgba( 0, 0, 0, .2);
      }

      .overlay-arrow.right {
        right: 0;
        left: auto;
        transform: translate(50%, -50%);
      }
      .overlay-close {
        float: right;
        cursor: pointer;
        transition: color 0.2s;
        color: var(--theme-brand-color-2);
      }
      .overlay-close:hover {
        color: var(--theme-brand-color-1);
      }
    </style>
    <div
      class="overlay"
      id="imageLightboxOverlay"
      active$="[[active]]"
      on-click="handleClick">
      <template
        is="dom-if"
        if="[[imageExists(position)]]">
        <dorel-product-image
          class="image"
          sizing="contain"
          height="[[windowHeight]]"
          image-url$="[[getImageUrl(position)]]">
        </dorel-product-image>
        <div
          id="overlayWrapper"
          class="overlay-wrapper"
          on-click="imageClick">
          <div
            id="overlayArrowLeft"
            class="overlay-arrow left"
            data-image$="[[getImageUrl(position)]]"
            on-click="_switchImage">
            <iron-icon class="dorel-cookie-notification__proceed-icon"
                       icon="dorel-icons:chevron-left"></iron-icon>
          </div>
          <div
          id="overlayArrowRight"
          class="overlay-arrow right"
          data-image$="[[getImageUrl(position)]]"
          on-click="_switchImage">
          <iron-icon class="dorel-cookie-notification__proceed-icon" icon="dorel-icons:chevron-right"></iron-icon>
        </div>
          <div
            id="overlayClose"
            class="overlay-close"
            on-click="_closeLightbox">
            <iron-icon class="dorel-cookie-notification__proceed-icon"
              icon="dorel-icons:close"></iron-icon>
          </div>
        </div>
        [[ _setImageWidth(position) ]]
      </template>
    </div>
  </template>

  <script>
    class DorelShowcaseZoomLightbox extends ReduxMixin(Polymer.Element) {
      static get is() {
        return 'dorel-showcase-zoom-lightbox';
      }

      static get properties() {
        return {
          /**
           * determines if the lightbox is shown
           */
          active: {
            type: Boolean,
            reflectToAttribute: true,
            statePath: 'image.imageLightbox.active'
          },

          /**
           * determines if the lightbox image a product image if true,
           */
          position: {
            type: String,
            reflectToAttribute: true,
            statePath: 'image.imageLightbox.position'
          },

          imageUrls: {
            type: Array,
            reflectToAttribute: true,
            statePath: 'image.imageLightbox.imageUrls'
          },

          /**
           * @name imageLeft
           * @description The left Image Url
           */
          imageLeft: {
            type: String,
            reflectToAttribute: true,
            statePath: 'image.imageLightbox.imageLeft'
          },

          /**
           * @name imageRight
           * @description The right Image Url
           */
          imageRight: {
            type: String,
            reflectToAttribute: true,
            statePath: 'image.imageLightbox.imageRight'
          },

          /**
           * determines if the lightbox image a product image if true,
           */
          bynderId: {
            type: Number,
            reflectToAttribute: true,
            statePath: 'image.imageLightbox.bynderId'
          },

          /**
           * height of the visitors viewport
           */
          windowHeight: {
            type: Number,
            value: () => window.innerHeight
          }
        }
      }

      ready() {
        super.ready();
        this.addEventListener('click', this._closeLightbox);
      }

      /**
       * Dont close the lightbox when clicked on image.
       */
      imageClick(event) {
        event.stopPropagation();
      }

      /**
       * when there is a click hide the lightbox
       */
      _closeLightbox() {
        this.dispatch('resetImageLightbox');
      }

      /**
       * Switch images after button clicks.
       */
      _switchImage(event) {
        event.stopPropagation();
        const image = event.currentTarget.dataset.image;
      }

      getImageUrl(index) {
        return this.get('imageUrls')[index];
      }

      imageExists(index) {
        const imageUrls = this.get('imageUrls');
        return imageUrls ? index <= this.get('imageUrls').length : false;
      }


      /**
       * Set the image width to the overlay in order to position the close icon.
       *
       * @param {String} url
       *   The url of the image you want to set the width of.
       */
      _setImageWidth(position) {
        const url = this.getImageUrl(position);
        Polymer.RenderStatus.afterNextRender(this, () => {
        const img = new Image();
        const element = this.shadowRoot.querySelector("#overlayWrapper");
        img.addEventListener("load", function() {
          element.style.width = "calc(" + 100 * (this.naturalWidth / this.naturalHeight) + "vh - 3em)";
        });
          img.src = url;
        });
      }

    }

    customElements.define(DorelShowcaseZoomLightbox.is, DorelShowcaseZoomLightbox);
  </script>
</dom-module>
