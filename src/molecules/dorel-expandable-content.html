<link rel="import" href="../../node_modules/@polymer/iron-collapse/iron-collapse.html">

<dom-module id="dorel-expandable-content">
  <template>
    <style>
      :host {
        --button-margin-spacing: -1.5em;
      }

      dorel-cta {
        float: left;
        width: auto;
        clear: both;
      }

      dorel-safe-html {
        display: block;
        clear: both;
        float: none;
      }

      iron-collapse {
        float: left;
        width: 100%;
      }

    </style>

    <template is="dom-if" if="[[content]]">
      <section class="expandable-content">
        <!-- Short first description -->
        <dorel-safe-html html="[[ initialContent ]]"></dorel-safe-html>
        <!-- Expandable/Collapsible longer description (if available) -->
        <template is="dom-if" if="[[ restContent ]]">
          <iron-collapse>
            <dorel-safe-html html="[[ restContent  ]]"></dorel-safe-html>
          </iron-collapse>
          <!-- Toggles expand and collapse -->
          <template is="dom-if" if="[[ !expanded ]]">
            <dorel-cta title="Read more"
                       on-click="_toggle"
                       type="link"
                       link=""
                       size="medium"
                       icon="dorel-icons:expand-more">
              {{ localize('Read_More') }}
            </dorel-cta>
          </template>
          <template is="dom-if" if="[[ expanded ]]">
            <dorel-cta title="Read less"
                       on-click="_toggle"
                       type="link"
                       link=""
                       size="medium"
                       icon="dorel-icons:expand-less">
              {{ localize('Read_Less') }}
            </dorel-cta>
          </template>
        </template>
      </section>
    </template>
  </template>

  <script>

    Polymer({
      is: 'dorel-expandable-content',

      behaviors: [
        DorelMultilingualBehavior
      ],      

      properties: {
        /**
         * @attribute
         * @name content
         * @description html content
         */
        content: {
          type: Object
        },
        /**
         * @attribute
         * @name expanded
         * @description boolean that for expanding/collapsing
         */
        expanded: {
          type: Boolean,
          value: false,
        },
        /**
         * @attribute
         * @name initialContent
         * @description Initially shown content, will be shortened
         */
        initialContent: {
          type: String,
          computed: '_computeInitialContent(content)'
        },
        /**
         * @attribute
         * @name restContent
         * @description Rest content, shown when component is expanded
         */
        restContent: {
          type: String,
          computed: '_computeRestContent(content)'
        },
      },

      /**
       * @name _computeInitialContent
       * @description Shortens the content if it's larger then character limit
       * **/
      _computeInitialContent: function (content) {
        if(!content) {
          return;
        }
        // Split the paragraphs in the content using a regular expression
        var re = new RegExp('(<p>.*<\/p>)', 'g');
        var splitContent = content.match(re);

        // Return a shortened version of the content (only the first paragraph)
        if (splitContent && splitContent.length > 1) {
          return splitContent[0];
        }

        // Returns the original content
        return content;
      },

      /**
       * @name _computeRestContent
       * @description The rest of the content
       * **/
      _computeRestContent: function (content) {

        if(!content) {
          return;
        }
        // Split the paragraphs in the content using a regular expression
        var re = new RegExp('(<p>.*<\/p>)', 'g');
        var splitContent = content.match(re);

        // Content is only split when there are more paragraphs
        if (splitContent && splitContent.length > 1) {
          // Remove first element in split content
          splitContent.shift();
          // Concatenate entries and return on string of rest content
          return splitContent.join('');
        }
      },
      /**
       * @name _toggle
       * @description expands/collapses content
       * **/
      _toggle: function () {
        this.$$('iron-collapse').toggle();
        this.expanded = !this.expanded;
      }
    });

  </script>
</dom-module>

