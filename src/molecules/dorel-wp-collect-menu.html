<link rel="import" href="../bower_components/polymer/polymer.html">
<dom-module id="dorel-wp-collect-menu">
  <template>
    <iron-ajax 
      auto 
      url="[[ wpUrl ]]/wp-api-menus/v2/menu-locations/[[ menuLocation ]]" 
      handle-as="json" 
      on-response="_menuLoaded"></iron-ajax>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'dorel-wp-collect-menu',
    properties: {

      /**
       * `menuData` this variable is reflected
       * by two way binding in order to use it in your
       * template.
       */
      menuData: {
        type: Array,
        reflectToAttribute: true,
        notify: true
      },

      /**
       * `menuLocation` fill in the menu_location name
       * defined in your Wordpress installation
       */
      menuLocation: {
        type: String
      },

      /**
       * `wpUrl` this is the url to your Wordpress instance
       */
      wpUrl: {
        type: String
      }
    },

    /** 
     * @name _menuLoaded
     * @description process the retrieved menu
     */
    _menuLoaded: function (data) {
      var menuItems = data.detail.response;

      // iterate over all menu items, alter its title and set the right url
      menuItems.forEach(function(item) {
        item.title = item.title.toLowerCase();
        item.url = '/' + item.url.split('/')[3];
      });

      // to retrieve the menu use Polymer.globalsManager.get('Dorel');
      Polymer.globalsManager.set('Dorel.collect.menuItems', menuItems);
    }
  });
</script>