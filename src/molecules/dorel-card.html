<link rel="import" href="../atoms/dorel-cta.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<dom-module id="dorel-card">
  <template>
    <style include="iron-flex">
			.card {
        width: 65%;
        margin: auto;
				padding: 2.25rem;
				position: relative;
				z-index: 1;
			}
			/*
			* Firefox rendering fix: The skewed container is now placed in a psuedo-selector behind actual content.
			* The Skew/Unskew method can create ugly text-rendering in Firefox, and unpredictable behaviour or appearance
			* of nested sub-elements.
			*/
			.card::before {
				background-color: rgba(255, 255, 255, .8);
				border-radius: 45px;
				transform: skewY(-4deg) translateZ(-1px);
        content: '';
				width: 100%;
				height: 100%;
				position: absolute;
				left: 0;
				top: 0;
				display: block;
				/* Safari rendering fix: The negative z-index places the background behind the content */
				z-index: -1;
			}

      dorel-cta {
        text-align: right;
        display: block;
      }

      .card-wrap .theme-headline {
        @apply(--theme-heading);
        font-size: 2rem;
        margin: 0;
      }

      #dorel-card p {
        margin-bottom: 2.5rem;
      }

      /**
      * Responsive definitions
      */
      .card[mobile-small], .card[mobile-medium]{
        width: 100%;
        margin: 0;
      }
    </style>

    <!-- media queries -->
    <iron-media-query query="(max-width : 479px)"
      query-matches="{{ mobileSmall }}"></iron-media-query>
    <iron-media-query query="(min-width : 480px) and (max-width : 767px)"
      query-matches="{{ mobileMedium }}"></iron-media-query>
    <iron-media-query query="(min-width : 768px) and (max-width : 991px)"
      query-matches="{{ tablets }}"></iron-media-query>
    <iron-media-query query="(min-width : 992px) and (max-width : 1199px)"
      query-matches="{{ desktopSmall }}"></iron-media-query>
    <iron-media-query query="(min-width : 1200px)"
      query-matches="{{ desktopFull }}"></iron-media-query>

    <template
      is="dom-if"
      if="{{ hasValue(skewed) }}">

      <div class="card"
           mobile-small$="{{ mobileSmall }}"
           mobile-medium$="{{ mobileMedium }}"
           tablets$="{{ tablets }}"
           desktop-small$="{{ desktopSmall }}"
           desktop-full$="{{ desktopFull }}">
        <div class="card-wrap">

        <!-- cardTitle -->
        <template
          is="dom-if"
          if="{{ hasValue(cardData.card_title) }}">
          <h2 class="theme-headline">[[ cardData.card_title ]]</h2>
        </template>
        <!--// cardTitle -->

        <!-- cardContent -->
        <template
          is="dom-if"
          if="{{ hasValue(cardData.card_text) }}">
          <dorel-safe-html html="[[ cardData.card_text ]]"></dorel-safe-html>
        </template>
        <!--// cardContent -->

        <!-- ctaToggle -->
        <template
          is="dom-if"
          if="{{ hasValue(cardData.card_cta_toggle) }}">
          <dorel-cta type="[[ cardData.card_cta_type ]]" link="[[ cardData.card_cta_link ]]">
            [[ cardData.card_cta_text ]]
          </dorel-cta>
          </div>
        </template>
        <!--// ctaToggle -->

        </div>
      </div>

    </template>

    <template
      is="dom-if"
      if="{{ !hasValue(skewed) }}">

      <div class="card">

        <!-- cardTitle -->
        <template
          is="dom-if"
          if="{{ hasValue(cardData.card_title) }}">
          <h1 class="theme-headline">[[ cardData.card_title ]]</h1>
        </template>
        <!--// cardTitle -->

        <!-- cardContent -->
        <template
          is="dom-if"
          if="{{ hasValue(cardData.card_text) }}">
          <dorel-safe-html html="[[ cardData.card_text ]]"></dorel-safe-html>
        </template>
        <!--// cardContent -->

        <!-- ctaToggle -->
        <template
          is="dom-if"
          if="{{ hasValue(cardData.card_cta_toggle) }}">
          <dorel-cta
            type="[[ cardData.card_cta_type ]]"
            link="[[ cardData.card_cta_link ]]">[[ cardData.card_cta_text ]]</dorel-cta>
          </div>
        </template>
        <!--// ctaToggle -->

      </div>

    </template>
  </template>

  <script>

    Polymer({
      is: 'dorel-card',

      properties: {

        /**
         * @attribute
         * @name cardData
         * @description data coming from ACF/Wordpress needed to build up this component
         */
        cardData: {
          type: Object
        },

        /**
         * @attribute
         * @name skewed
         * @description attribute to determine styling skewed
         */
        skewed: {
          type: Boolean
        }

      },

      /**
       * @name hasValue
       * @description checks to see if a value is not empty, undefined or null
       */
      hasValue: function(val) {
        return (typeof val !== '' && val !== 'undefined' && val !== null);
      }
    });

  </script>

</dom-module>
