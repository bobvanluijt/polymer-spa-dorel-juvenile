<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">

<dom-module id="dorel-user-tools">
  <template strip-whitespace>
    <style include="iron-flex iron-flex-alignment">
      .container {
        padding: 0 var(--theme-gutter);
        height: var(--theme-scale-5);
        width: 100%;
        @apply(--layout-flex-auto);
        @apply(--layout-horizontal);
        @apply(--layout-center);
        color: var(--theme-color-black);
      }

      [screenSmall] .container {
        padding: 0 var(--theme-gutter-mobile);
      }

      .icn-big {
        --iron-icon-height: var(--theme-scale-2);
        --iron-icon-width: var(--theme-scale-2);
      }

      .icn-trigger:hover {
        cursor: pointer;
      }

      .icon-toggle-menu {
        z-index: 1001;
        padding: 0;
      }

      .centered {
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
      }

      .active {
        color: white; /* var(--theme-white) */
        background-color: var(--theme-brand-color);
      }

      .active:after {
        content: '';
        background-color: var(--theme-brand-color);
        position: absolute;
        margin-top: 23px;
        height: 15px;
        width: 100%;
      }

      .icn-search-section-trigger {
        padding: 0;
      }

      .icn-search-section-trigger[screenMediumUp] {
        padding: 0;
      }

      iron-icon {
        width: var(--theme-scale-3);
        height: var(--theme-scale-3);
      }

    </style>

    <iron-media-query query="(max-width : 767px)"
                      query-matches="{{ screenSmall }}"></iron-media-query>
    <iron-media-query query="(min-width : 768px)"
                      query-matches="{{ screenMediumUp }}"></iron-media-query>

    <div screenSmall$="{{ screenSmall }}" screenMediumUp$="{{ screenMediumUp }}">
      <!-- moved to dorel-header -->
      <!-- only show hamburger menu on small screens -->
      <!-- <template is="dom-if" if="{{ screenSmall }}">
        <div class="container">
          <template
            is="dom-if"
            if="{{ !mobileMenuOpened }}">
            <paper-icon-button
              class="paper-icn-big icon-toggle-menu"
              icon="dorel-icons:menu"
              on-click="_toggleMobileMenu"
              aria-label="menu">
            </paper-icon-button>
          </template>

          <template
            is="dom-if"
            if="{{ mobileMenuOpened }}">
            <paper-icon-button
              class="paper-icn-big icon-toggle-menu"
              icon="dorel-icons:close"
              on-click="_toggleMobileMenu"
              aria-label="menu">
            </paper-icon-button>
          </template>
        </div>
      </template> -->
      <!-- Currently disabled for MVP launch (DIO-680). TODO: Uncomment when search functionality is implemented
      <div class="centered">
        <template
          is="dom-if"
          if="{{ !searchOpened }}">
          <iron-icon
            icon="dorel-icons:search"
            class="icn-big icn-trigger icn-search-section-trigger"
            on-click="_toggleSearch"
            screenMediumUp$="{{ screenMediumUp }}">
          </iron-icon>
        </template>

        <template
          is="dom-if"
          if="{{ searchOpened }}">
          <iron-icon
            icon="dorel-icons:close"
            class="icn-big icn-trigger icn-search-section-trigger active"
            on-click="_toggleSearch"
            screenMediumUp$="{{ screenMediumUp }}">
          </iron-icon>
        </template>
        -->
      <!-- Removed in favor of DIO-588
        <iron-icon
          icon="dorel-icons:shopping-cart"
          class="icn-big left-spacing">
        </iron-icon>
    </div>
    -->
    </div>


  </template>
  <script>
    Polymer({
      is: 'dorel-user-tools',

      properties: {

        /**
         * @name searchOpened
         * @description variable that indicates if the search component
         * is opened
         */
        searchOpened: {
          type: Boolean,
          value: false,
          notify: true
        },

        /**
         * @name mobileMenuOpened
         * @description variable that indicates if the mobileMenu component
         * is opened
         */
        mobileMenuOpened: {
          type: Boolean,
          value: false,
          notify: true
        },

        /**
         * @name subMenuOpened
         * @description variable that indicates if the subMenuOpened (desktop)
         * component is opened
         */
        subMenuOpened: {
          type: Boolean,
          value: false,
          notify: true
        }

      },

      /**
       * @name _toggleMobileMenu
       * @description handler for toggling the mobile menu
       */
      _toggleMobileMenu: function (event) {

        // search component will always be false
        this.searchOpened = false;

        // submenu (desktop) will always be false
        this.subMenuOpened = false;

        // actual mobileMenu toggler
        this.mobileMenuOpened = !this.mobileMenuOpened;

        // send event to tracking
        this._eventTracking(event, this.mobileMenuOpened);
      },

      /**
       * @name _toggleSearch
       * @description handler for toggling the search or not
       */
      _toggleSearch: function (event) {

        // mobileMenu will always be false
        this.mobileMenuOpened = false;

        // subMenuOpened will always be false
        this.subMenuOpened = false;

        // actual search toggler
        this.searchOpened = !this.searchOpened;

        // send event to tracking
        this._eventTracking(event, this.searchOpened);
      },

      /**
       * @name _eventTracking
       * @description sets the right properties for event tracking
       */
      _eventTracking: function (event, type) {
        /**
         * define component, for user-tools we have:
         * - mobile trigger
         * - search trigger
         * - cart (TODO)
         */
        // assign local target
        var localTarget = Polymer.dom(event).localTarget;

        // define component in string
        var component = (localTarget.classList.contains('icon-toggle-menu')) ? 'mobileMenu' : 'search';

        /**
         * build up the tracking eventData
         */
        var eventData = {
          action: (type) ? 'open' : 'close',
          component: component,
          element: Polymer.dom(event).localTarget,
          event: 'polymer_event',
        };

        // set the tracking data, this will trigger dorel-gtm-events
        Polymer.globalsManager.set('Dorel.events', eventData);
      }
    });
  </script>
</dom-module>
