<link rel="import" href="../dropdown-items/dorel-dropdown-card.html">

<dom-module id="dorel-menu-dropdown-category" opened$="[[ opened]]">
  <template>
    <style>
      :host {
        width: 100%;
        margin: 0;
        position: absolute;
        left: 0;
        transform: translate(0, -100%) scaleY(1);
        top: var(--theme-menu-offset);
        z-index: -5;
        opacity: 1;
        visibility: hidden;
        transition: all 0.25s;
        transform-origin: top;
        max-height: 80vh;
        overflow: visible;
        cursor: default;
        background-color: var(--theme-color-monochrome-2);
        -webkit-box-shadow: 0px 10px 10px 0px rgba(0, 0, 0, 0.13);
        -moz-box-shadow: 0px 10px 10px 0px rgba(0, 0, 0, 0.13);
        box-shadow: 0px 10px 10px 0px rgba(0, 0, 0, 0.13);
        padding-bottom: 1.5em;

      }

      :host-context([opened]) {
        transform: translate(0, 0) scaleY(1);
        top: var(--theme-menu-offset);
        opacity: 1;
        visibility: visible;
        transition: all 0.25s;
      }

      .dropdown-menu {
        list-style-type: none;
        margin: 0;
        padding: 0;
        float: left;
        width: 100%
      }

      .view-all-cta {
        margin-top: 1.5em;
        float: left;
        width: 100%;
      }

      .dropdown-menu-item {
        margin-top: .75rem;
      }

      .dropdown-menu-item:first-child {
        margin-top: 0;
      }

      dorel-dropdown-card {
        height: 100%;
      }
    </style>
    <dorel-layout-container>
      <dorel-layout-row align="right">
        <template
          is="dom-repeat"
          items="[[ featuredItems ]]"
          as="card">
          <dorel-layout-column desktop-column-span="2" tablet-column-span="4" mobile-column-span="12">
            <dorel-dropdown-card
              is-active="[[ checkIfActive(card.link, route) ]]"
              card-data="[[ _transformToCartData(card) ]]"
              cta-type="[[ ctaType ]]"
              gtm-parent="[[ gtmParent ]]"
              gtm-parent-index="[[ gtmParentIndex ]]"
              gtm-child="dorel-card"
              cta-type="link"
              gtm-child-index="[[ index ]]"></dorel-dropdown-card>
          </dorel-layout-column>
        </template>
        <dorel-layout-column desktop-column-span="2" tablet-column-span="4" mobile-column-span="12">
          <ul class="dropdown-menu" id="dropdownMenu">
            <template is="dom-repeat" items="[[ _maxItems(dropdownItems) ]]" as="menuItem">
              <li class="dropdown-menu-item" is-active$="[[ checkIfActive(menuItem.link, route) ]]">

                <dorel-cta title="[[ menuItem.title ]]"
                           type="link"
                           on-click="clickMenuItem"
                           link="[[ menuItem.link ]]"
                           size="small"
                           no-margin
                           icon="dorel-icons:chevron-right"
                           gtm-parent="dorel-navigation-main"
                           gtm-parent="[[ gtmParent ]]"
                           gtm-parent-index="[[ gtmParentIndex ]]"
                           gtm-child="[[ gtmChild ]]"
                           gtm-child-index="[[ gtmChildIndex ]]"
                           gtm-cta-index="[[ index ]]">
                  [[ menuItem.title ]]
                </dorel-cta>
              </li>
            </template>
          </ul>
          <dorel-cta title="{{ localize('All') }} [[ mainItem.title ]]"
                     type="primary"
                     class="view-all-cta"
                     link="[[ mainItem.link ]]"
                     size="medium"
                     no-margin
                     icon="dorel-icons:chevron-right"
                     gtm-action="plan-route-retailer"
                     gtm-parent="[[ gtmParent ]]"
                     gtm-parent-index="[[ gtmParentIndex ]]"
                     gtm-child="[[ gtmChild ]]"
                     gtm-child-index="[[ gtmChildIndex ]]"
                     gtm-cta-index="0">
            {{ localize('All') }} [[ mainItem.title ]]

          </dorel-cta>
        </dorel-layout-column>
      </dorel-layout-row>
    </dorel-layout-container>

  </template>
  <script>

    Polymer({
      is: 'dorel-menu-dropdown-category',
      properties: {

        /**
         * @name dropdownItems
         * @description array of links
         */
        dropdownItems: {
          type: Array,
          value: function () {
            return [];
          }
        },

        /**
         * @name featuredItems
         * @description array of featured links (subcategories or products)
         */
        featuredItems: {
          type: Array,
          value: function () {
            return [];
          }
        },

        /**
         * @name mainItem
         * @description the main link
         */
        mainItem: {
          type: Object
        },

        /**
         * @name index
         * @description index of the item
         */
        index: {
          type: Number
        },

        /**
         * @name route
         * @description current route / url of the application
         */
        route: {
          type: Object
        }

      },

      behaviors: [MainMenuBehavior, DorelMultilingualBehavior],


      /**
       * @name clickMenuItem
       * @description closes the mobile menu and calls _emitGtmEvent
       * @param event - Object
       */
      clickMenuItem: function (event) {
        this._emitGtmEvent(event);
      },

      setDropdownId: function (mainItem) {
        return 'dropdown' + mainItem.id;
      },

      _transformToCartData: function (item) {
        var card = {
          card_title: item.title,
          link: item.link,
          sub_title: item.sub_title
        };

        if (item.thumbnail_url) {
          card.image_url = item.thumbnail_url;
        } else {
          card.bynder_card_image = item.thumbnail;
        }
        return card;
      },

      _maxItems: function (dropdownItems) {
        return dropdownItems.filter(function (item, index) {
          return index < 4 ? true : false;
        })
      }

    });

  </script>
</dom-module>
